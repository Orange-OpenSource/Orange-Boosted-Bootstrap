.tag {
  --#{$prefix}tag-min-width: #{$ouds-tag-size-min-width-default};
  --#{$prefix}tag-min-height: #{$ouds-tag-size-min-height-default};
  --#{$prefix}tag-color: #{$ouds-color-content-on-status-neutral-emphasized};
  --#{$prefix}tag-border-width: 0px;
  --#{$prefix}tag-background-color: #{$ouds-color-surface-status-neutral-emphasized};
  --#{$prefix}tag-padding-start: #{$ouds-tag-space-padding-inline-default};
  --#{$prefix}tag-padding-end: #{$ouds-tag-space-padding-inline-default};
  --#{$prefix}tag-padding-asset: #{$ouds-tag-space-padding-inline-asset-default};
  --#{$prefix}tag-padding-y: #{$ouds-tag-space-padding-block-default};
  --#{$prefix}tag-size-asset: #{px-to-rem($ouds-tag-size-asset-default)};
  --#{$prefix}tag-asset-gap: #{$ouds-tag-space-column-gap-default};
  --#{$prefix}tag-asset-color: currentcolor;
  --#{$prefix}tag-loading-dasharray: 92;
  --#{$prefix}tag-loading-animation: 2.1875s infinite linear rotate1-indeterminate, 1.25s linear infinite rotate2-indeterminate;
  --#{$prefix}tag-positive-icon: url("data:image/svg+xml,<svg viewBox='0 0 960 960' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M500,75C265.279,75,75,265.279,75,500S265.279,925,500,925,925,734.721,925,500,734.721,75,500,75ZM722.051,339.988l-254.642,320-0.007-.006a39.635,39.635,0,0,1-62.125,0l-0.006.005-127.321-160,0.006-.006a40.142,40.142,0,0,1,2.928-53.267l15.915-16a39.612,39.612,0,0,1,54.022-2.077l0.006-.008L428.382,515,663.77,285.818l0.006,0.008A39.734,39.734,0,0,1,730.77,315a39.952,39.952,0,0,1-8.726,24.981Z' transform='scale(.96)' fill='currentColor'/></svg>");
  --#{$prefix}tag-info-icon: url("data:image/svg+xml,<svg viewBox='0 0 960 960' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M500,75.5c-234.72,0-425,190.28-425,425s190.28,425,425,425,425-190.28,425-425S734.72,75.5,500,75.5Zm0,100a75,75,0,1,1-75,75A75,75,0,0,1,500,175.5Zm125,600H400V749.763l5.287-.167c15.555-.5,27.115-4.919,34.368-13.136,2.576-2.972,6.956-13.1,6.956-47.153v-227.2c0-32.392-4.523-44.6-8.311-49.141-5.359-6.391-16.516-10.147-33.17-11.156L400,401.5v-26H575V689.307c0,32.415,8.457,44.618,12.24,49.142,5.34,6.389,15.68,10.142,32.625,11.152l5.135,0.3v25.6Z' transform='scale(.96)' fill='currentColor'/></svg>");
  --#{$prefix}tag-warning-icon: url("data:image/svg+xml,<svg viewBox='0 0 960 960' xmlns='http://www.w3.org/2000/svg'><g transform='scale(.96)'><path id='Exclamation_Mark_warning' fill-rule='evenodd' d='M500.5,74.75C265.088,74.75,74.249,265.59,74.249,501S265.088,927.25,500.5,927.25,926.751,736.412,926.751,501,735.912,74.75,500.5,74.75ZM460.578,237.1c10.208-10.906,23.587-16.481,39.92-17.04,16.319,0.559,29.7,6.134,39.907,17.04q16.134,17.256,16.149,48.079c0,15.088-21.166,292.627-26.357,303.885s-14.487,16.893-27.855,16.893c-0.666,0-1.2-.194-1.844-0.229-0.649.035-1.2,0.229-1.858,0.229q-20.05,0-27.842-16.893c-5.2-11.258-26.358-288.8-26.358-303.885Q444.44,254.357,460.578,237.1Zm79.273,529.988a56.906,56.906,0,0,1-38.99,14.85,58.393,58.393,0,0,1-39.535-14.675q-16.885-14.66-16.886-41.01,0-23.025,16.138-39.179t39.548-16.147q23.376,0,39.913,16.147a52.768,52.768,0,0,1,16.521,39.179Q556.56,752.232,539.851,767.088Z' fill='currentColor'/></g></svg>");
  --#{$prefix}tag-negative-icon: url("data:image/svg+xml,<svg viewBox='0 0 960 960' xmlns='http://www.w3.org/2000/svg'><g transform='scale(.96)'><path id='error_severe' fill-rule='evenodd' d='M863.641,699.619l0.008,0L571.982,199.365l-0.008,0a83.294,83.294,0,0,0-143.948,0l-0.007,0L137.068,698.386l-0.031.053-0.685,1.176,0.007,0A83.369,83.369,0,0,0,208.334,825H791.667A83.369,83.369,0,0,0,863.641,699.619ZM628.9,689.894a34.271,34.271,0,0,1-48.477,0L500,609.432l-80.423,80.462a34.285,34.285,0,1,1-48.469-48.5l80.421-80.454-77.562-77.6a34.288,34.288,0,0,1,48.479-48.5l77.56,77.6,77.559-77.6a34.287,34.287,0,1,1,48.474,48.5l-77.56,77.6L628.9,641.391A34.318,34.318,0,0,1,628.9,689.894Z' fill='currentColor'/></g></svg>");

  position: relative;
  display: inline-flex;
  gap: var(--#{$prefix}tag-asset-gap);
  align-items: center;
  justify-content: center;
  min-width: var(--#{$prefix}tag-min-width);
  min-height: var(--#{$prefix}tag-min-height);
  padding: subtract(var(--#{$prefix}tag-padding-y), var(--#{$prefix}tag-border-width)) subtract(var(--#{$prefix}tag-padding-end), var(--#{$prefix}tag-border-width)) subtract(var(--#{$prefix}tag-padding-y), var(--#{$prefix}tag-border-width)) subtract(var(--#{$prefix}tag-padding-start), var(--#{$prefix}tag-border-width));
  margin: 0;
  font-weight: 700;
  color: var(--#{$prefix}tag-color);
  white-space: nowrap;
  background-color: var(--#{$prefix}tag-background-color);
  @include get-font-size("label-medium");
  @include border-radius($ouds-tag-border-radius);

  &.text-bg-status-accent-muted {
    --#{$prefix}tag-asset-color: #{$ouds-color-surface-status-accent-emphasized};
  }

  &.text-bg-status-positive-muted {
    --#{$prefix}tag-asset-color: #{$ouds-color-surface-status-positive-emphasized};
  }

  &.text-bg-status-info-muted {
    --#{$prefix}tag-asset-color: #{$ouds-color-surface-status-info-emphasized};
  }

  &.text-bg-status-warning-muted {
    --#{$prefix}tag-asset-color: #{$ouds-color-surface-status-warning-emphasized};
  }

  &.text-bg-status-negative-muted {
    --#{$prefix}tag-asset-color: #{$ouds-color-surface-status-negative-emphasized};
  }

  &:has(.tag-asset-container) {
    --#{$prefix}tag-padding-start: var(--#{$prefix}tag-padding-asset);
  }

  .tag-icon,
  .tag-status-icon,
  .tag-bullet,
  .tag-loader {
    display: flex;
    flex-shrink: 0;
    align-items: center;
    width: var(--#{$prefix}tag-size-asset);
    height: var(--#{$prefix}tag-size-asset);
    padding: #{$ouds-tag-space-inset-icon-default};
    overflow: hidden;
    line-height: 1;
    color: var(--#{$prefix}tag-asset-color);
  }

  .tag-status-icon {
    vertical-align: middle;
    background-color: var(--#{$prefix}tag-asset-color);
    background-size: contain;
  }

  .tag-bullet {
    width: calc(var(--#{$prefix}tag-size-asset) - (2 * #{$ouds-tag-space-inset-bullet-default})); // stylelint-disable-line function-disallowed-list
    height: calc(var(--#{$prefix}tag-size-asset) - (2 * #{$ouds-tag-space-inset-bullet-default})); // stylelint-disable-line function-disallowed-list
    padding: 0;
    margin: #{$ouds-tag-space-inset-bullet-default};
    background-color: var(--#{$prefix}tag-asset-color);
    @include border-radius(#{$ouds-border-radius-pill});
  }

  &.text-bg-status-positive-emphasized,
  &.text-bg-status-positive-muted {
    .tag-status-icon {
      mask-image: escape-svg(var(--#{$prefix}tag-positive-icon));
    }
  }

  &.text-bg-status-info-emphasized,
  &.text-bg-status-info-muted {
    .tag-status-icon {
      mask-image: escape-svg(var(--#{$prefix}tag-info-icon));
    }
  }

  &.text-bg-status-warning-emphasized,
  &.text-bg-status-warning-muted {
    .tag-status-icon {
      mask-image: escape-svg(var(--#{$prefix}tag-warning-icon));
    }
  }

  &.text-bg-status-negative-emphasized,
  &.text-bg-status-negative-muted {
    .tag-status-icon {
      mask-image: escape-svg(var(--#{$prefix}tag-negative-icon));
    }
  }

  &:not(.loading) .tag-loader {
    display: none;
  }

  &.loading:has(.tag-loader) {
    color: #{$ouds-color-content-default} if($enable-important-utilities, !important, null);
    background-color: #{$ouds-color-surface-status-neutral-muted} if($enable-important-utilities, !important, null);
  }

  .tag-loader { // TODO partially copied from button loader, should be factorized as much as possible
    --#{$prefix}tag-asset-color: currentcolor;
    display: block;
    margin: 0;
    font-size: var(--#{$prefix}tag-size-asset);
    transform: rotate(-90deg);

    > .tag-loader-inner {
      fill: none;
      stroke: var(--#{$prefix}tag-asset-color);
      stroke-dasharray: var(--#{$prefix}tag-loading-dasharray);
      stroke-width: 8;
      transform-origin: center;
      animation: var(--#{$prefix}tag-loading-animation);
    }
  }

  .disabled &,
  &.disabled {
    color: #{$ouds-color-content-on-action-disabled} if($enable-important-utilities, !important, null);
    background-color:#{$ouds-color-action-disabled} if($enable-important-utilities, !important, null);
  }
}

.tag-sm {
  --#{$prefix}tag-padding-start: #{$ouds-tag-space-padding-inline-small};
  --#{$prefix}tag-padding-end: #{$ouds-tag-space-padding-inline-small};
  --#{$prefix}tag-padding-start-asset: #{$ouds-tag-space-padding-inline-asset-small};
  --#{$prefix}tag-padding-y: #{$ouds-tag-space-padding-block-small};
  --#{$prefix}tag-min-width: #{$ouds-tag-size-min-width-small};
  --#{$prefix}tag-min-height: #{$ouds-tag-size-min-height-small};
  --#{$prefix}tag-size-asset: #{px-to-rem($ouds-tag-size-asset-small)};
  --#{$prefix}tag-bullet-padding: #{$ouds-tag-space-inset-bullet-small};
  --#{$prefix}tag-icon-padding: #{$ouds-tag-space-inset-icon-small};
  --#{$prefix}tag-loader-padding: #{$ouds-tag-space-inset-loader-small};
  --#{$prefix}tag-asset-gap: #{$ouds-tag-space-column-gap-small};
  @include get-font-size("label-small");
}

.tag-input {
  --#{$prefix}tag-color: #{$ouds-tag-input-color-content-enabled};
  --#{$prefix}tag-background-color: #{$ouds-tag-input-color-bg-enabled};
  --#{$prefix}tag-border-color: #{$ouds-tag-input-color-border-enabled};
  --#{$prefix}tag-border-width: #{$ouds-tag-input-border-width-default};
  --#{$prefix}tag-padding-end: var(--#{$prefix}tag-padding-asset);

  margin: calc(($ouds-tag-size-min-height-interactive-area - var(--#{$prefix}tag-min-height)) / 2) 0; // stylelint-disable-line function-disallowed-list
  border: var(--#{$prefix}tag-border-width) solid var(--#{$prefix}tag-border-color);

  &::before {
    position: absolute;
    top: calc(-.5 * ($ouds-tag-size-min-height-interactive-area - var(--bs-tag-min-height)) - var(--#{$prefix}tag-border-width)); // stylelint-disable-line function-disallowed-list
    right: calc(-1 * var(--#{$prefix}tag-border-width)); // stylelint-disable-line function-disallowed-list
    bottom: calc(-.5 * ($ouds-tag-size-min-height-interactive-area - var(--bs-tag-min-height)) - var(--#{$prefix}tag-border-width)); // stylelint-disable-line function-disallowed-list
    left: calc(-1 * var(--#{$prefix}tag-border-width)); // stylelint-disable-line function-disallowed-list
    content: "";
  }

  &::after {
    width: var(--#{$prefix}tag-size-asset);
    height: var(--#{$prefix}tag-size-asset);
    content: "";
    background-color: currentcolor;
    mask: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 1000'><path d='M500 83.333 416.667 0 250 166.667 83.333 0 0 83.333 166.667 250 0 416.667 83.333 500 250 333.333 416.667 500 500 416.667 333.333 250z' transform='translate(250 250)'/></svg>");
  }

  &:hover {
    --#{$prefix}tag-color: #{$ouds-tag-input-color-content-hover};
    --#{$prefix}tag-background-color: #{$ouds-tag-input-color-bg-hover};
    --#{$prefix}tag-border-color: #{$ouds-tag-input-color-border-hover};
    --#{$prefix}tag-border-width: #{$ouds-tag-input-border-width-default-interaction};
  }

  &:active {
    --#{$prefix}tag-color: #{$ouds-tag-input-color-content-pressed};
    --#{$prefix}tag-background-color: #{$ouds-tag-input-color-bg-pressed};
    --#{$prefix}tag-border-color: #{$ouds-tag-input-color-border-pressed};
    --#{$prefix}tag-border-width: #{$ouds-tag-input-border-width-default-interaction};
  }

  &:focus-visible {
    --#{$prefix}tag-color: #{$ouds-tag-input-color-content-focus};
    --#{$prefix}tag-background-color: #{$ouds-tag-input-color-bg-focus};
    --#{$prefix}tag-border-color: #{$ouds-tag-input-color-border-focus};
    --#{$prefix}tag-border-width: #{$ouds-tag-input-border-width-default-interaction};
  }

  &:disabled,
  &[aria-disabled="true"] {
    --#{$prefix}tag-color: #{$ouds-color-action-disabled};
    --#{$prefix}tag-background-color: #{$ouds-color-content-on-action-disabled};
    --#{$prefix}tag-border-color: #{$ouds-color-action-disabled};
    --#{$prefix}tag-border-width: #{$ouds-tag-input-border-width-default};

    pointer-events: none;
  }
}
