{"version":3,"file":"common.mjs","sources":["../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/location/navigation_adapter_for_location.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/i18n/locale_data.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/platform_id.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/version.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/viewport_scroller.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/image_loaders/constants.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/url.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/image_loaders/image_loader.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/image_loaders/cloudflare_loader.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/image_loaders/cloudinary_loader.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/image_loaders/imagekit_loader.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/image_loaders/imgix_loader.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/image_loaders/netlify_loader.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/error_helper.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/asserts.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/lcp_image_observer.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/preconnect_link_checker.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/tokens.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/preload-link-creator.ts","../../../../../k8-fastbuild-ST-fdfa778d11ba/bin/packages/common/src/directives/ng_optimized_image/ng_optimized_image.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {Injectable, inject, DestroyRef} from '@angular/core';\nimport {PlatformNavigation} from '../navigation/platform_navigation';\nimport {Location} from './location';\nimport {LocationStrategy} from './location_strategy';\nimport {normalizeQueryParams} from './util';\n\n/**\n * A `Location` implementation that uses the browser's `Navigation` API.\n *\n * This class is an adapter that maps the methods of the `Location` service to the newer\n * browser `Navigation` API. It is used when the `Navigation` API is available.\n *\n * This adapter uses `navigation.navigate()` for `go` and `replaceState` to ensure a single source\n * of truth for the navigation state. The Navigation API's state and `history.state` are separate.\n *\n * Note that `navigation.back()` and `navigation.forward()` can differ from the traditional\n * `history` API in how they traverse the joint session history.\n *\n * @see {@link Location}\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Navigation_API\n */\n@Injectable()\nexport class NavigationAdapterForLocation extends Location {\n  private readonly navigation = inject(PlatformNavigation);\n  private readonly destroyRef = inject(DestroyRef);\n\n  constructor() {\n    super(inject(LocationStrategy));\n\n    this.registerNavigationListeners();\n  }\n\n  private registerNavigationListeners() {\n    const currentEntryChangeListener = () => {\n      this._notifyUrlChangeListeners(this.path(true), this.getState());\n    };\n    this.navigation.addEventListener('currententrychange', currentEntryChangeListener);\n    this.destroyRef.onDestroy(() => {\n      this.navigation.removeEventListener('currententrychange', currentEntryChangeListener);\n    });\n  }\n\n  override getState(): unknown {\n    return this.navigation.currentEntry?.getState();\n  }\n\n  override replaceState(path: string, query: string = '', state: any = null): void {\n    const url = this.prepareExternalUrl(path + normalizeQueryParams(query));\n    // Use navigation API consistently for navigations. The \"navigation API state\"\n    // field has no interaction with the existing \"serialized state\" field, which is what backs history.state\n    this.navigation.navigate(url, {state, history: 'replace'});\n  }\n\n  override go(path: string, query: string = '', state: any = null): void {\n    const url = this.prepareExternalUrl(path + normalizeQueryParams(query));\n    // Use navigation API consistently for navigations. The \"navigation API state\"\n    // field has no interaction with the existing \"serialized state\" field, which is what backs history.state\n    this.navigation.navigate(url, {state, history: 'push'});\n  }\n\n  // Navigation.back/forward differs from history in how it traverses the joint session history\n  // https://github.com/WICG/navigation-api?tab=readme-ov-file#correspondence-with-the-joint-session-history\n  override back() {\n    this.navigation.back();\n  }\n\n  override forward() {\n    this.navigation.forward();\n  }\n\n  override onUrlChange(fn: (url: string, state: unknown) => void): VoidFunction {\n    this._urlChangeListeners.push(fn);\n\n    return () => {\n      const fnIndex = this._urlChangeListeners.indexOf(fn);\n      this._urlChangeListeners.splice(fnIndex, 1);\n    };\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {ɵregisterLocaleData} from '@angular/core';\n\n/**\n * Register global data to be used internally by Angular. See the\n * [\"I18n guide\"](guide/i18n/format-data-locale) to know how to import additional locale\n * data.\n *\n * The signature registerLocaleData(data: any, extraData?: any) is deprecated since v5.1\n *\n * @publicApi\n */\nexport function registerLocaleData(data: any, localeId?: string | any, extraData?: any): void {\n  return ɵregisterLocaleData(data, localeId, extraData);\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nexport const PLATFORM_BROWSER_ID = 'browser';\nexport const PLATFORM_SERVER_ID = 'server';\n\n/**\n * Returns whether a platform id represents a browser platform.\n * @publicApi\n */\nexport function isPlatformBrowser(platformId: Object): boolean {\n  return platformId === PLATFORM_BROWSER_ID;\n}\n\n/**\n * Returns whether a platform id represents a server platform.\n * @publicApi\n */\nexport function isPlatformServer(platformId: Object): boolean {\n  return platformId === PLATFORM_SERVER_ID;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\n/**\n * @module\n * @description\n * Entry point for all public APIs of the common package.\n */\n\nimport {Version} from '@angular/core';\n\n/**\n * @publicApi\n */\nexport const VERSION = /* @__PURE__ */ new Version('21.0.8');\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  inject,\n  ɵɵdefineInjectable,\n  DOCUMENT,\n  ɵformatRuntimeError as formatRuntimeError,\n} from '@angular/core';\nimport {RuntimeErrorCode} from './errors';\n\n/**\n * Defines a scroll position manager. Implemented by `BrowserViewportScroller`.\n *\n * @publicApi\n */\nexport abstract class ViewportScroller {\n  // De-sugared tree-shakable injection\n  // See #23917\n  /** @nocollapse */\n  static ɵprov = /** @pureOrBreakMyCode */ /* @__PURE__ */ ɵɵdefineInjectable({\n    token: ViewportScroller,\n    providedIn: 'root',\n    factory: () =>\n      typeof ngServerMode !== 'undefined' && ngServerMode\n        ? new NullViewportScroller()\n        : new BrowserViewportScroller(inject(DOCUMENT), window),\n  });\n\n  /**\n   * Configures the top offset used when scrolling to an anchor.\n   * @param offset A position in screen coordinates (a tuple with x and y values)\n   * or a function that returns the top offset position.\n   *\n   */\n  abstract setOffset(offset: [number, number] | (() => [number, number])): void;\n\n  /**\n   * Retrieves the current scroll position.\n   * @returns A position in screen coordinates (a tuple with x and y values).\n   */\n  abstract getScrollPosition(): [number, number];\n\n  /**\n   * Scrolls to a specified position.\n   * @param position A position in screen coordinates (a tuple with x and y values).\n   */\n  abstract scrollToPosition(position: [number, number], options?: ScrollOptions): void;\n\n  /**\n   * Scrolls to an anchor element.\n   * @param anchor The ID of the anchor element.\n   */\n  abstract scrollToAnchor(anchor: string, options?: ScrollOptions): void;\n\n  /**\n   * Disables automatic scroll restoration provided by the browser.\n   * See also [window.history.scrollRestoration\n   * info](https://developers.google.com/web/updates/2015/09/history-api-scroll-restoration).\n   */\n  abstract setHistoryScrollRestoration(scrollRestoration: 'auto' | 'manual'): void;\n}\n\n/**\n * Manages the scroll position for a browser window.\n */\nexport class BrowserViewportScroller implements ViewportScroller {\n  private offset: () => [number, number] = () => [0, 0];\n\n  constructor(\n    private document: Document,\n    private window: Window,\n  ) {}\n\n  /**\n   * Configures the top offset used when scrolling to an anchor.\n   * @param offset A position in screen coordinates (a tuple with x and y values)\n   * or a function that returns the top offset position.\n   *\n   */\n  setOffset(offset: [number, number] | (() => [number, number])): void {\n    if (Array.isArray(offset)) {\n      this.offset = () => offset;\n    } else {\n      this.offset = offset;\n    }\n  }\n\n  /**\n   * Retrieves the current scroll position.\n   * @returns The position in screen coordinates.\n   */\n  getScrollPosition(): [number, number] {\n    return [this.window.scrollX, this.window.scrollY];\n  }\n\n  /**\n   * Sets the scroll position.\n   * @param position The new position in screen coordinates.\n   */\n  scrollToPosition(position: [number, number], options?: ScrollOptions): void {\n    this.window.scrollTo({...options, left: position[0], top: position[1]});\n  }\n\n  /**\n   * Scrolls to an element and attempts to focus the element.\n   *\n   * Note that the function name here is misleading in that the target string may be an ID for a\n   * non-anchor element.\n   *\n   * @param target The ID of an element or name of the anchor.\n   *\n   * @see https://html.spec.whatwg.org/#the-indicated-part-of-the-document\n   * @see https://html.spec.whatwg.org/#scroll-to-fragid\n   */\n  scrollToAnchor(target: string, options?: ScrollOptions): void {\n    const elSelected = findAnchorFromDocument(this.document, target);\n\n    if (elSelected) {\n      this.scrollToElement(elSelected, options);\n      // After scrolling to the element, the spec dictates that we follow the focus steps for the\n      // target. Rather than following the robust steps, simply attempt focus.\n      //\n      // @see https://html.spec.whatwg.org/#get-the-focusable-area\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLOrForeignElement/focus\n      // @see https://html.spec.whatwg.org/#focusable-area\n      elSelected.focus();\n    }\n  }\n\n  /**\n   * Disables automatic scroll restoration provided by the browser.\n   */\n  setHistoryScrollRestoration(scrollRestoration: 'auto' | 'manual'): void {\n    try {\n      this.window.history.scrollRestoration = scrollRestoration;\n    } catch {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.SCROLL_RESTORATION_UNSUPPORTED,\n          ngDevMode &&\n            'Failed to set `window.history.scrollRestoration`. ' +\n              'This may occur when:\\n' +\n              '• The script is running inside a sandboxed iframe\\n' +\n              '• The window is partially navigated or inactive\\n' +\n              '• The script is executed in an untrusted or special context (e.g., test runners, browser extensions, or content previews)\\n' +\n              'Scroll position may not be preserved across navigation.',\n        ),\n      );\n    }\n  }\n\n  /**\n   * Scrolls to an element using the native offset and the specified offset set on this scroller.\n   *\n   * The offset can be used when we know that there is a floating header and scrolling naively to an\n   * element (ex: `scrollIntoView`) leaves the element hidden behind the floating header.\n   */\n  private scrollToElement(el: HTMLElement, options?: ScrollOptions): void {\n    const rect = el.getBoundingClientRect();\n    const left = rect.left + this.window.pageXOffset;\n    const top = rect.top + this.window.pageYOffset;\n    const offset = this.offset();\n    this.window.scrollTo({\n      ...options,\n      left: left - offset[0],\n      top: top - offset[1],\n    });\n  }\n}\n\nfunction findAnchorFromDocument(document: Document, target: string): HTMLElement | null {\n  const documentResult = document.getElementById(target) || document.getElementsByName(target)[0];\n\n  if (documentResult) {\n    return documentResult;\n  }\n\n  // `getElementById` and `getElementsByName` won't pierce through the shadow DOM so we\n  // have to traverse the DOM manually and do the lookup through the shadow roots.\n  if (\n    typeof document.createTreeWalker === 'function' &&\n    document.body &&\n    typeof document.body.attachShadow === 'function'\n  ) {\n    const treeWalker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);\n    let currentNode = treeWalker.currentNode as HTMLElement | null;\n\n    while (currentNode) {\n      const shadowRoot = currentNode.shadowRoot;\n\n      if (shadowRoot) {\n        // Note that `ShadowRoot` doesn't support `getElementsByName`\n        // so we have to fall back to `querySelector`.\n        const result =\n          shadowRoot.getElementById(target) || shadowRoot.querySelector(`[name=\"${target}\"]`);\n        if (result) {\n          return result;\n        }\n      }\n\n      currentNode = treeWalker.nextNode() as HTMLElement | null;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Provides an empty implementation of the viewport scroller.\n */\nexport class NullViewportScroller implements ViewportScroller {\n  /**\n   * Empty implementation\n   */\n  setOffset(offset: [number, number] | (() => [number, number])): void {}\n\n  /**\n   * Empty implementation\n   */\n  getScrollPosition(): [number, number] {\n    return [0, 0];\n  }\n\n  /**\n   * Empty implementation\n   */\n  scrollToPosition(position: [number, number]): void {}\n\n  /**\n   * Empty implementation\n   */\n  scrollToAnchor(anchor: string): void {}\n\n  /**\n   * Empty implementation\n   */\n  setHistoryScrollRestoration(scrollRestoration: 'auto' | 'manual'): void {}\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\n/**\n * Value (out of 100) of the requested quality for placeholder images.\n */\nexport const PLACEHOLDER_QUALITY = '20';\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\n// Converts a string that represents a URL into a URL class instance.\nexport function getUrl(src: string, win: Window): URL {\n  // Don't use a base URL is the URL is absolute.\n  return isAbsoluteUrl(src) ? new URL(src) : new URL(src, win.location.href);\n}\n\n// Checks whether a URL is absolute (i.e. starts with `http://` or `https://`).\nexport function isAbsoluteUrl(src: string): boolean {\n  return /^https?:\\/\\//.test(src);\n}\n\n// Given a URL, extract the hostname part.\n// If a URL is a relative one - the URL is returned as is.\nexport function extractHostname(url: string): string {\n  return isAbsoluteUrl(url) ? new URL(url).hostname : url;\n}\n\nexport function isValidPath(path: unknown): boolean {\n  const isString = typeof path === 'string';\n\n  if (!isString || path.trim() === '') {\n    return false;\n  }\n\n  // Calling new URL() will throw if the path string is malformed\n  try {\n    const url = new URL(path);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function normalizePath(path: string): string {\n  return path.endsWith('/') ? path.slice(0, -1) : path;\n}\n\nexport function normalizeSrc(src: string): string {\n  return src.startsWith('/') ? src.slice(1) : src;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {InjectionToken, Provider, ɵRuntimeError as RuntimeError} from '@angular/core';\n\nimport {RuntimeErrorCode} from '../../../errors';\nimport {isAbsoluteUrl, isValidPath, normalizePath, normalizeSrc} from '../url';\n\n/**\n * Config options recognized by the image loader function.\n *\n * @see {@link ImageLoader}\n * @see {@link NgOptimizedImage}\n * @publicApi\n */\nexport interface ImageLoaderConfig {\n  /**\n   * Image file name to be added to the image request URL.\n   */\n  src: string;\n  /**\n   * Width of the requested image (to be used when generating srcset).\n   */\n  width?: number;\n  /**\n   * Whether the loader should generate a URL for a small image placeholder instead of a full-sized\n   * image.\n   */\n  isPlaceholder?: boolean;\n  /**\n   * Additional user-provided parameters for use by the ImageLoader.\n   */\n  loaderParams?: {[key: string]: any};\n}\n\n/**\n * Represents an image loader function. Image loader functions are used by the\n * NgOptimizedImage directive to produce full image URL based on the image name and its width.\n *\n * @publicApi\n */\nexport type ImageLoader = (config: ImageLoaderConfig) => string;\n\n/**\n * Noop image loader that does no transformation to the original src and just returns it as is.\n * This loader is used as a default one if more specific logic is not provided in an app config.\n *\n * @see {@link ImageLoader}\n * @see {@link NgOptimizedImage}\n */\nexport const noopImageLoader = (config: ImageLoaderConfig) => config.src;\n\n/**\n * Metadata about the image loader.\n */\nexport type ImageLoaderInfo = {\n  name: string;\n  testUrl: (url: string) => boolean;\n};\n\n/**\n * Injection token that configures the image loader function.\n *\n * @see {@link ImageLoader}\n * @see {@link NgOptimizedImage}\n * @publicApi\n */\nexport const IMAGE_LOADER = new InjectionToken<ImageLoader>(\n  typeof ngDevMode !== 'undefined' && ngDevMode ? 'ImageLoader' : '',\n  {\n    factory: () => noopImageLoader,\n  },\n);\n\n/**\n * Internal helper function that makes it easier to introduce custom image loaders for the\n * `NgOptimizedImage` directive. It is enough to specify a URL builder function to obtain full DI\n * configuration for a given loader: a DI token corresponding to the actual loader function, plus DI\n * tokens managing preconnect check functionality.\n * @param buildUrlFn a function returning a full URL based on loader's configuration\n * @param exampleUrls example of full URLs for a given loader (used in error messages)\n * @returns a set of DI providers corresponding to the configured image loader\n */\nexport function createImageLoader(\n  buildUrlFn: (path: string, config: ImageLoaderConfig) => string,\n  exampleUrls?: string[],\n) {\n  return function provideImageLoader(path: string) {\n    if (!isValidPath(path)) {\n      throwInvalidPathError(path, exampleUrls || []);\n    }\n\n    // The trailing / is stripped (if provided) to make URL construction (concatenation) easier in\n    // the individual loader functions.\n    path = normalizePath(path);\n\n    const loaderFn = (config: ImageLoaderConfig) => {\n      if (isAbsoluteUrl(config.src)) {\n        // Image loader functions expect an image file name (e.g. `my-image.png`)\n        // or a relative path + a file name (e.g. `/a/b/c/my-image.png`) as an input,\n        // so the final absolute URL can be constructed.\n        // When an absolute URL is provided instead - the loader can not\n        // build a final URL, thus the error is thrown to indicate that.\n        throwUnexpectedAbsoluteUrlError(path, config.src);\n      }\n\n      return buildUrlFn(path, {...config, src: normalizeSrc(config.src)});\n    };\n\n    const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: loaderFn}];\n    return providers;\n  };\n}\n\nfunction throwInvalidPathError(path: unknown, exampleUrls: string[]): never {\n  throw new RuntimeError(\n    RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n    ngDevMode &&\n      `Image loader has detected an invalid path (\\`${path}\\`). ` +\n        `To fix this, supply a path using one of the following formats: ${exampleUrls.join(\n          ' or ',\n        )}`,\n  );\n}\n\nfunction throwUnexpectedAbsoluteUrlError(path: string, url: string): never {\n  throw new RuntimeError(\n    RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n    ngDevMode &&\n      `Image loader has detected a \\`<img>\\` tag with an invalid \\`ngSrc\\` attribute: ${url}. ` +\n        `This image loader expects \\`ngSrc\\` to be a relative URL - ` +\n        `however the provided value is an absolute URL. ` +\n        `To fix this, provide \\`ngSrc\\` as a path relative to the base URL ` +\n        `configured for this loader (\\`${path}\\`).`,\n  );\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {Provider} from '@angular/core';\nimport {PLACEHOLDER_QUALITY} from './constants';\nimport {createImageLoader, ImageLoaderConfig} from './image_loader';\n\n/**\n * Function that generates an ImageLoader for [Cloudflare Image\n * Resizing](https://developers.cloudflare.com/images/image-resizing/) and turns it into an Angular\n * provider. Note: Cloudflare has multiple image products - this provider is specifically for\n * Cloudflare Image Resizing; it will not work with Cloudflare Images or Cloudflare Polish.\n *\n * @param path Your domain name, e.g. https://mysite.com\n * @returns Provider that provides an ImageLoader function\n *\n * @see [Image Optimization Guide](guide/image-optimization)\n * @publicApi\n */\nexport const provideCloudflareLoader: (path: string) => Provider[] = createImageLoader(\n  createCloudflareUrl,\n  ngDevMode ? ['https://<ZONE>/cdn-cgi/image/<OPTIONS>/<SOURCE-IMAGE>'] : undefined,\n);\n\nfunction createCloudflareUrl(path: string, config: ImageLoaderConfig) {\n  let params = `format=auto`;\n  if (config.width) {\n    params += `,width=${config.width}`;\n  }\n\n  // When requesting a placeholder image we ask for a low quality image to reduce the load time.\n  if (config.isPlaceholder) {\n    params += `,quality=${PLACEHOLDER_QUALITY}`;\n  }\n\n  // Cloudflare image URLs format:\n  // https://developers.cloudflare.com/images/image-resizing/url-format/\n  return `${path}/cdn-cgi/image/${params}/${config.src}`;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {Provider} from '@angular/core';\nimport {createImageLoader, ImageLoaderConfig, ImageLoaderInfo} from './image_loader';\n\n/**\n * Name and URL tester for Cloudinary.\n */\nexport const cloudinaryLoaderInfo: ImageLoaderInfo = {\n  name: 'Cloudinary',\n  testUrl: isCloudinaryUrl,\n};\n\nconst CLOUDINARY_LOADER_REGEX = /https?\\:\\/\\/[^\\/]+\\.cloudinary\\.com\\/.+/;\n/**\n * Tests whether a URL is from Cloudinary CDN.\n */\nfunction isCloudinaryUrl(url: string): boolean {\n  return CLOUDINARY_LOADER_REGEX.test(url);\n}\n\n/**\n * Function that generates an ImageLoader for Cloudinary and turns it into an Angular provider.\n *\n * @param path Base URL of your Cloudinary images\n * This URL should match one of the following formats:\n * https://res.cloudinary.com/mysite\n * https://mysite.cloudinary.com\n * https://subdomain.mysite.com\n * @returns Set of providers to configure the Cloudinary loader.\n *\n * @see [Image Optimization Guide](guide/image-optimization)\n * @publicApi\n */\nexport const provideCloudinaryLoader: (path: string) => Provider[] = createImageLoader(\n  createCloudinaryUrl,\n  ngDevMode\n    ? [\n        'https://res.cloudinary.com/mysite',\n        'https://mysite.cloudinary.com',\n        'https://subdomain.mysite.com',\n      ]\n    : undefined,\n);\n\nfunction createCloudinaryUrl(path: string, config: ImageLoaderConfig) {\n  // Cloudinary image URLformat:\n  // https://cloudinary.com/documentation/image_transformations#transformation_url_structure\n  // Example of a Cloudinary image URL:\n  // https://res.cloudinary.com/mysite/image/upload/c_scale,f_auto,q_auto,w_600/marketing/tile-topics-m.png\n\n  // For a placeholder image, we use the lowest image setting available to reduce the load time\n  // else we use the auto size\n  const quality = config.isPlaceholder ? 'q_auto:low' : 'q_auto';\n\n  let params = `f_auto,${quality}`;\n  if (config.width) {\n    params += `,w_${config.width}`;\n  }\n\n  if (config.loaderParams?.['rounded']) {\n    params += `,r_max`;\n  }\n\n  return `${path}/image/upload/${params}/${config.src}`;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {Provider} from '@angular/core';\nimport {PLACEHOLDER_QUALITY} from './constants';\nimport {createImageLoader, ImageLoaderConfig, ImageLoaderInfo} from './image_loader';\n\n/**\n * Name and URL tester for ImageKit.\n */\nexport const imageKitLoaderInfo: ImageLoaderInfo = {\n  name: 'ImageKit',\n  testUrl: isImageKitUrl,\n};\n\nconst IMAGE_KIT_LOADER_REGEX = /https?\\:\\/\\/[^\\/]+\\.imagekit\\.io\\/.+/;\n/**\n * Tests whether a URL is from ImageKit CDN.\n */\nfunction isImageKitUrl(url: string): boolean {\n  return IMAGE_KIT_LOADER_REGEX.test(url);\n}\n\n/**\n * Function that generates an ImageLoader for ImageKit and turns it into an Angular provider.\n *\n * @param path Base URL of your ImageKit images\n * This URL should match one of the following formats:\n * https://ik.imagekit.io/myaccount\n * https://subdomain.mysite.com\n * @returns Set of providers to configure the ImageKit loader.\n *\n * @see [Image Optimization Guide](guide/image-optimization)\n * @publicApi\n */\nexport const provideImageKitLoader: (path: string) => Provider[] = createImageLoader(\n  createImagekitUrl,\n  ngDevMode ? ['https://ik.imagekit.io/mysite', 'https://subdomain.mysite.com'] : undefined,\n);\n\nexport function createImagekitUrl(path: string, config: ImageLoaderConfig): string {\n  // Example of an ImageKit image URL:\n  // https://ik.imagekit.io/demo/tr:w-300,h-300/medium_cafe_B1iTdD0C.jpg\n  const {src, width} = config;\n  const params: string[] = [];\n\n  if (width) {\n    params.push(`w-${width}`);\n  }\n\n  // When requesting a placeholder image we ask for a low quality image to reduce the load time.\n  if (config.isPlaceholder) {\n    params.push(`q-${PLACEHOLDER_QUALITY}`);\n  }\n\n  const urlSegments = params.length ? [path, `tr:${params.join(',')}`, src] : [path, src];\n  const url = new URL(urlSegments.join('/'));\n  return url.href;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {Provider} from '@angular/core';\nimport {PLACEHOLDER_QUALITY} from './constants';\nimport {createImageLoader, ImageLoaderConfig, ImageLoaderInfo} from './image_loader';\n\n/**\n * Name and URL tester for Imgix.\n */\nexport const imgixLoaderInfo: ImageLoaderInfo = {\n  name: 'Imgix',\n  testUrl: isImgixUrl,\n};\n\nconst IMGIX_LOADER_REGEX = /https?\\:\\/\\/[^\\/]+\\.imgix\\.net\\/.+/;\n/**\n * Tests whether a URL is from Imgix CDN.\n */\nfunction isImgixUrl(url: string): boolean {\n  return IMGIX_LOADER_REGEX.test(url);\n}\n\n/**\n * Function that generates an ImageLoader for Imgix and turns it into an Angular provider.\n *\n * @param path path to the desired Imgix origin,\n * e.g. https://somepath.imgix.net or https://images.mysite.com\n * @returns Set of providers to configure the Imgix loader.\n *\n * @see [Image Optimization Guide](guide/image-optimization)\n * @publicApi\n */\nexport const provideImgixLoader: (path: string) => Provider[] = createImageLoader(\n  createImgixUrl,\n  ngDevMode ? ['https://somepath.imgix.net/'] : undefined,\n);\n\nfunction createImgixUrl(path: string, config: ImageLoaderConfig) {\n  const url = new URL(`${path}/${config.src}`);\n  // This setting ensures the smallest allowable format is set.\n  url.searchParams.set('auto', 'format');\n  if (config.width) {\n    url.searchParams.set('w', config.width.toString());\n  }\n\n  // When requesting a placeholder image we ask a low quality image to reduce the load time.\n  if (config.isPlaceholder) {\n    url.searchParams.set('q', PLACEHOLDER_QUALITY);\n  }\n  return url.href;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  Provider,\n  ɵformatRuntimeError as formatRuntimeError,\n  ɵRuntimeError as RuntimeError,\n} from '@angular/core';\n\nimport {RuntimeErrorCode} from '../../../errors';\nimport {isAbsoluteUrl, isValidPath} from '../url';\n\nimport {IMAGE_LOADER, ImageLoaderConfig, ImageLoaderInfo} from './image_loader';\nimport {PLACEHOLDER_QUALITY} from './constants';\n\n/**\n * Name and URL tester for Netlify.\n */\nexport const netlifyLoaderInfo: ImageLoaderInfo = {\n  name: 'Netlify',\n  testUrl: isNetlifyUrl,\n};\n\nconst NETLIFY_LOADER_REGEX = /https?\\:\\/\\/[^\\/]+\\.netlify\\.app\\/.+/;\n\n/**\n * Tests whether a URL is from a Netlify site. This won't catch sites with a custom domain,\n * but it's a good start for sites in development. This is only used to warn users who haven't\n * configured an image loader.\n */\nfunction isNetlifyUrl(url: string): boolean {\n  return NETLIFY_LOADER_REGEX.test(url);\n}\n\n/**\n * Function that generates an ImageLoader for Netlify and turns it into an Angular provider.\n *\n * @param path optional URL of the desired Netlify site. Defaults to the current site.\n * @returns Set of providers to configure the Netlify loader.\n *\n * @publicApi\n */\nexport function provideNetlifyLoader(path?: string) {\n  if (path && !isValidPath(path)) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n      ngDevMode &&\n        `Image loader has detected an invalid path (\\`${path}\\`). ` +\n          `To fix this, supply either the full URL to the Netlify site, or leave it empty to use the current site.`,\n    );\n  }\n\n  if (path) {\n    const url = new URL(path);\n    path = url.origin;\n  }\n\n  const loaderFn = (config: ImageLoaderConfig) => {\n    return createNetlifyUrl(config, path);\n  };\n\n  const providers: Provider[] = [{provide: IMAGE_LOADER, useValue: loaderFn}];\n  return providers;\n}\n\nconst validParams = new Map<string, string>([\n  ['height', 'h'],\n  ['fit', 'fit'],\n  ['quality', 'q'],\n  ['q', 'q'],\n  ['position', 'position'],\n]);\n\nfunction createNetlifyUrl(config: ImageLoaderConfig, path?: string) {\n  // Note: `path` can be undefined, in which case we use a fake one to construct a `URL` instance.\n  const url = new URL(path ?? 'https://a/');\n  url.pathname = '/.netlify/images';\n\n  if (!isAbsoluteUrl(config.src) && !config.src.startsWith('/')) {\n    config.src = '/' + config.src;\n  }\n\n  url.searchParams.set('url', config.src);\n\n  if (config.width) {\n    url.searchParams.set('w', config.width.toString());\n  }\n\n  // When requesting a placeholder image we ask for a low quality image to reduce the load time.\n  // If the quality is specified in the loader config - always use provided value.\n  const configQuality = config.loaderParams?.['quality'] ?? config.loaderParams?.['q'];\n  if (config.isPlaceholder && !configQuality) {\n    url.searchParams.set('q', PLACEHOLDER_QUALITY);\n  }\n\n  for (const [param, value] of Object.entries(config.loaderParams ?? {})) {\n    if (validParams.has(param)) {\n      url.searchParams.set(validParams.get(param)!, value.toString());\n    } else {\n      if (ngDevMode) {\n        console.warn(\n          formatRuntimeError(\n            RuntimeErrorCode.INVALID_LOADER_ARGUMENTS,\n            `The Netlify image loader has detected an \\`<img>\\` tag with the unsupported attribute \"\\`${param}\\`\".`,\n          ),\n        );\n      }\n    }\n  }\n  // The \"a\" hostname is used for relative URLs, so we can remove it from the final URL.\n  return url.hostname === 'a' ? url.href.replace(url.origin, '') : url.href;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\n// Assembles directive details string, useful for error messages.\nexport function imgDirectiveDetails(ngSrc: string, includeNgSrc = true) {\n  const ngSrcInfo = includeNgSrc\n    ? `(activated on an <img> element with the \\`ngSrc=\"${ngSrc}\"\\`) `\n    : '';\n  return `The NgOptimizedImage directive ${ngSrcInfo}has detected that`;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {ɵRuntimeError as RuntimeError} from '@angular/core';\n\nimport {RuntimeErrorCode} from '../../errors';\n\n/**\n * Asserts that the application is in development mode. Throws an error if the application is in\n * production mode. This assert can be used to make sure that there is no dev-mode code invoked in\n * the prod mode accidentally.\n */\nexport function assertDevMode(checkName: string) {\n  if (!ngDevMode) {\n    throw new RuntimeError(\n      RuntimeErrorCode.UNEXPECTED_DEV_MODE_CHECK_IN_PROD_MODE,\n      `Unexpected invocation of the ${checkName} in the prod mode. ` +\n        `Please make sure that the prod mode is enabled for production builds.`,\n    );\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  inject,\n  Injectable,\n  OnDestroy,\n  ɵformatRuntimeError as formatRuntimeError,\n  DOCUMENT,\n} from '@angular/core';\n\nimport {RuntimeErrorCode} from '../../errors';\n\nimport {assertDevMode} from './asserts';\nimport {imgDirectiveDetails} from './error_helper';\nimport {getUrl} from './url';\n\ninterface ObservedImageState {\n  priority: boolean;\n  modified: boolean;\n  alreadyWarnedPriority: boolean;\n  alreadyWarnedModified: boolean;\n}\n\n/**\n * Observer that detects whether an image with `NgOptimizedImage`\n * is treated as a Largest Contentful Paint (LCP) element. If so,\n * asserts that the image has the `priority` attribute.\n *\n * Note: this is a dev-mode only class and it does not appear in prod bundles,\n * thus there is no `ngDevMode` use in the code.\n *\n * Based on https://web.dev/lcp/#measure-lcp-in-javascript.\n */\n@Injectable({providedIn: 'root'})\nexport class LCPImageObserver implements OnDestroy {\n  // Map of full image URLs -> original `ngSrc` values.\n  private images = new Map<string, ObservedImageState>();\n\n  private window: Window | null = inject(DOCUMENT).defaultView;\n  private observer: PerformanceObserver | null = null;\n\n  constructor() {\n    assertDevMode('LCP checker');\n\n    if (\n      (typeof ngServerMode === 'undefined' || !ngServerMode) &&\n      typeof PerformanceObserver !== 'undefined'\n    ) {\n      this.observer = this.initPerformanceObserver();\n    }\n  }\n\n  /**\n   * Inits PerformanceObserver and subscribes to LCP events.\n   * Based on https://web.dev/lcp/#measure-lcp-in-javascript\n   */\n  private initPerformanceObserver(): PerformanceObserver {\n    const observer = new PerformanceObserver((entryList) => {\n      const entries = entryList.getEntries();\n      if (entries.length === 0) return;\n      // We use the latest entry produced by the `PerformanceObserver` as the best\n      // signal on which element is actually an LCP one. As an example, the first image to load on\n      // a page, by virtue of being the only thing on the page so far, is often a LCP candidate\n      // and gets reported by PerformanceObserver, but isn't necessarily the LCP element.\n      const lcpElement = entries[entries.length - 1];\n\n      // Cast to `any` due to missing `element` on the `LargestContentfulPaint` type of entry.\n      // See https://developer.mozilla.org/en-US/docs/Web/API/LargestContentfulPaint\n      const imgSrc = (lcpElement as any).element?.src ?? '';\n\n      // Exclude `data:` and `blob:` URLs, since they are not supported by the directive.\n      if (imgSrc.startsWith('data:') || imgSrc.startsWith('blob:')) return;\n\n      const img = this.images.get(imgSrc);\n      if (!img) return;\n      if (!img.priority && !img.alreadyWarnedPriority) {\n        img.alreadyWarnedPriority = true;\n        logMissingPriorityError(imgSrc);\n      }\n      if (img.modified && !img.alreadyWarnedModified) {\n        img.alreadyWarnedModified = true;\n        logModifiedWarning(imgSrc);\n      }\n    });\n    observer.observe({type: 'largest-contentful-paint', buffered: true});\n    return observer;\n  }\n\n  registerImage(rewrittenSrc: string, originalNgSrc: string, isPriority: boolean) {\n    if (!this.observer) return;\n    const newObservedImageState: ObservedImageState = {\n      priority: isPriority,\n      modified: false,\n      alreadyWarnedModified: false,\n      alreadyWarnedPriority: false,\n    };\n    this.images.set(getUrl(rewrittenSrc, this.window!).href, newObservedImageState);\n  }\n\n  unregisterImage(rewrittenSrc: string) {\n    if (!this.observer) return;\n    this.images.delete(getUrl(rewrittenSrc, this.window!).href);\n  }\n\n  updateImage(originalSrc: string, newSrc: string) {\n    if (!this.observer) return;\n    const originalUrl = getUrl(originalSrc, this.window!).href;\n    const img = this.images.get(originalUrl);\n    if (img) {\n      img.modified = true;\n      this.images.set(getUrl(newSrc, this.window!).href, img);\n      this.images.delete(originalUrl);\n    }\n  }\n\n  ngOnDestroy() {\n    if (!this.observer) return;\n    this.observer.disconnect();\n    this.images.clear();\n  }\n}\n\nfunction logMissingPriorityError(ngSrc: string) {\n  const directiveDetails = imgDirectiveDetails(ngSrc);\n  console.error(\n    formatRuntimeError(\n      RuntimeErrorCode.LCP_IMG_MISSING_PRIORITY,\n      `${directiveDetails} this image is the Largest Contentful Paint (LCP) ` +\n        `element but was not marked \"priority\". This image should be marked ` +\n        `\"priority\" in order to prioritize its loading. ` +\n        `To fix this, add the \"priority\" attribute.`,\n    ),\n  );\n}\n\nfunction logModifiedWarning(ngSrc: string) {\n  const directiveDetails = imgDirectiveDetails(ngSrc);\n  console.warn(\n    formatRuntimeError(\n      RuntimeErrorCode.LCP_IMG_NGSRC_MODIFIED,\n      `${directiveDetails} this image is the Largest Contentful Paint (LCP) ` +\n        `element and has had its \"ngSrc\" attribute modified. This can cause ` +\n        `slower loading performance. It is recommended not to modify the \"ngSrc\" ` +\n        `property on any image which could be the LCP element.`,\n    ),\n  );\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  inject,\n  Injectable,\n  InjectionToken,\n  ɵformatRuntimeError as formatRuntimeError,\n  DOCUMENT,\n  OnDestroy,\n} from '@angular/core';\n\nimport {RuntimeErrorCode} from '../../errors';\n\nimport {assertDevMode} from './asserts';\nimport {imgDirectiveDetails} from './error_helper';\nimport {extractHostname, getUrl} from './url';\n\n// Set of origins that are always excluded from the preconnect checks.\nconst INTERNAL_PRECONNECT_CHECK_BLOCKLIST = new Set(['localhost', '127.0.0.1', '0.0.0.0', '[::1]']);\n\n/**\n * Injection token to configure which origins should be excluded\n * from the preconnect checks. It can either be a single string or an array of strings\n * to represent a group of origins, for example:\n *\n * ```ts\n *  {provide: PRECONNECT_CHECK_BLOCKLIST, useValue: 'https://your-domain.com'}\n * ```\n *\n * or:\n *\n * ```ts\n *  {provide: PRECONNECT_CHECK_BLOCKLIST,\n *   useValue: ['https://your-domain-1.com', 'https://your-domain-2.com']}\n * ```\n *\n * @publicApi\n */\nexport const PRECONNECT_CHECK_BLOCKLIST = new InjectionToken<Array<string | string[]>>(\n  typeof ngDevMode !== 'undefined' && ngDevMode ? 'PRECONNECT_CHECK_BLOCKLIST' : '',\n);\n\n/**\n * Contains the logic to detect whether an image, marked with the \"priority\" attribute\n * has a corresponding `<link rel=\"preconnect\">` tag in the `document.head`.\n *\n * Note: this is a dev-mode only class, which should not appear in prod bundles,\n * thus there is no `ngDevMode` use in the code.\n */\n@Injectable({providedIn: 'root'})\nexport class PreconnectLinkChecker implements OnDestroy {\n  private document = inject(DOCUMENT);\n\n  /**\n   * Set of <link rel=\"preconnect\"> tags found on this page.\n   * The `null` value indicates that there was no DOM query operation performed.\n   */\n  private preconnectLinks: Set<string> | null = null;\n\n  /*\n   * Keep track of all already seen origin URLs to avoid repeating the same check.\n   */\n  private alreadySeen = new Set<string>();\n\n  private window: Window | null = this.document.defaultView;\n\n  private blocklist = new Set<string>(INTERNAL_PRECONNECT_CHECK_BLOCKLIST);\n\n  constructor() {\n    assertDevMode('preconnect link checker');\n    const blocklist = inject(PRECONNECT_CHECK_BLOCKLIST, {optional: true});\n    if (blocklist) {\n      this.populateBlocklist(blocklist);\n    }\n  }\n\n  private populateBlocklist(origins: Array<string | string[]> | string) {\n    if (Array.isArray(origins)) {\n      deepForEach(origins, (origin) => {\n        this.blocklist.add(extractHostname(origin));\n      });\n    } else {\n      this.blocklist.add(extractHostname(origins));\n    }\n  }\n\n  /**\n   * Checks that a preconnect resource hint exists in the head for the\n   * given src.\n   *\n   * @param rewrittenSrc src formatted with loader\n   * @param originalNgSrc ngSrc value\n   */\n  assertPreconnect(rewrittenSrc: string, originalNgSrc: string): void {\n    if (typeof ngServerMode !== 'undefined' && ngServerMode) return;\n\n    const imgUrl = getUrl(rewrittenSrc, this.window!);\n    if (this.blocklist.has(imgUrl.hostname) || this.alreadySeen.has(imgUrl.origin)) return;\n\n    // Register this origin as seen, so we don't check it again later.\n    this.alreadySeen.add(imgUrl.origin);\n\n    // Note: we query for preconnect links only *once* and cache the results\n    // for the entire lifespan of an application, since it's unlikely that the\n    // list would change frequently. This allows to make sure there are no\n    // performance implications of making extra DOM lookups for each image.\n    this.preconnectLinks ??= this.queryPreconnectLinks();\n\n    if (!this.preconnectLinks.has(imgUrl.origin)) {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.PRIORITY_IMG_MISSING_PRECONNECT_TAG,\n          `${imgDirectiveDetails(originalNgSrc)} there is no preconnect tag present for this ` +\n            `image. Preconnecting to the origin(s) that serve priority images ensures that these ` +\n            `images are delivered as soon as possible. To fix this, please add the following ` +\n            `element into the <head> of the document:\\n` +\n            `  <link rel=\"preconnect\" href=\"${imgUrl.origin}\">`,\n        ),\n      );\n    }\n  }\n\n  private queryPreconnectLinks(): Set<string> {\n    const preconnectUrls = new Set<string>();\n    const links = this.document.querySelectorAll<HTMLLinkElement>('link[rel=preconnect]');\n    for (const link of links) {\n      const url = getUrl(link.href, this.window!);\n      preconnectUrls.add(url.origin);\n    }\n    return preconnectUrls;\n  }\n\n  ngOnDestroy() {\n    this.preconnectLinks?.clear();\n    this.alreadySeen.clear();\n  }\n}\n\n/**\n * Invokes a callback for each element in the array. Also invokes a callback\n * recursively for each nested array.\n */\nfunction deepForEach<T>(input: (T | any[])[], fn: (value: T) => void): void {\n  for (let value of input) {\n    Array.isArray(value) ? deepForEach(value, fn) : fn(value);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {InjectionToken} from '@angular/core';\n\n/**\n * In SSR scenarios, a preload `<link>` element is generated for priority images.\n * Having a large number of preload tags may negatively affect the performance,\n * so we warn developers (by throwing an error) if the number of preloaded images\n * is above a certain threshold. This const specifies this threshold.\n */\nexport const DEFAULT_PRELOADED_IMAGES_LIMIT = 5;\n\n/**\n * Helps to keep track of priority images that already have a corresponding\n * preload tag (to avoid generating multiple preload tags with the same URL).\n *\n * This Set tracks the original src passed into the `ngSrc` input not the src after it has been\n * run through the specified `IMAGE_LOADER`.\n */\nexport const PRELOADED_IMAGES = new InjectionToken<Set<string>>(\n  typeof ngDevMode === 'undefined' || ngDevMode ? 'NG_OPTIMIZED_PRELOADED_IMAGES' : '',\n  {\n    factory: () => new Set<string>(),\n  },\n);\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  inject,\n  Injectable,\n  Renderer2,\n  ɵformatRuntimeError as formatRuntimeError,\n  DOCUMENT,\n} from '@angular/core';\n\nimport {RuntimeErrorCode} from '../../errors';\n\nimport {DEFAULT_PRELOADED_IMAGES_LIMIT, PRELOADED_IMAGES} from './tokens';\n\n/**\n * @description Contains the logic needed to track and add preload link tags to the `<head>` tag. It\n * will also track what images have already had preload link tags added so as to not duplicate link\n * tags.\n *\n * In dev mode this service will validate that the number of preloaded images does not exceed the\n * configured default preloaded images limit: {@link DEFAULT_PRELOADED_IMAGES_LIMIT}.\n */\n@Injectable({providedIn: 'root'})\nexport class PreloadLinkCreator {\n  private readonly preloadedImages = inject(PRELOADED_IMAGES);\n  private readonly document = inject(DOCUMENT);\n  private errorShown = false;\n\n  /**\n   * @description Add a preload `<link>` to the `<head>` of the `index.html` that is served from the\n   * server while using Angular Universal and SSR to kick off image loads for high priority images.\n   *\n   * The `sizes` (passed in from the user) and `srcset` (parsed and formatted from `ngSrcset`)\n   * properties used to set the corresponding attributes, `imagesizes` and `imagesrcset`\n   * respectively, on the preload `<link>` tag so that the correctly sized image is preloaded from\n   * the CDN.\n   *\n   * {@link https://web.dev/preload-responsive-images/#imagesrcset-and-imagesizes}\n   *\n   * @param renderer The `Renderer2` passed in from the directive\n   * @param src The original src of the image that is set on the `ngSrc` input.\n   * @param srcset The parsed and formatted srcset created from the `ngSrcset` input\n   * @param sizes The value of the `sizes` attribute passed in to the `<img>` tag\n   */\n  createPreloadLinkTag(renderer: Renderer2, src: string, srcset?: string, sizes?: string): void {\n    if (\n      ngDevMode &&\n      !this.errorShown &&\n      this.preloadedImages.size >= DEFAULT_PRELOADED_IMAGES_LIMIT\n    ) {\n      this.errorShown = true;\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.TOO_MANY_PRELOADED_IMAGES,\n          `The \\`NgOptimizedImage\\` directive has detected that more than ` +\n            `${DEFAULT_PRELOADED_IMAGES_LIMIT} images were marked as priority. ` +\n            `This might negatively affect an overall performance of the page. ` +\n            `To fix this, remove the \"priority\" attribute from images with less priority.`,\n        ),\n      );\n    }\n\n    if (this.preloadedImages.has(src)) {\n      return;\n    }\n\n    this.preloadedImages.add(src);\n\n    const preload = renderer.createElement('link');\n    renderer.setAttribute(preload, 'as', 'image');\n    renderer.setAttribute(preload, 'href', src);\n    renderer.setAttribute(preload, 'rel', 'preload');\n    renderer.setAttribute(preload, 'fetchpriority', 'high');\n\n    if (sizes) {\n      renderer.setAttribute(preload, 'imageSizes', sizes);\n    }\n\n    if (srcset) {\n      renderer.setAttribute(preload, 'imageSrcset', srcset);\n    }\n\n    renderer.appendChild(this.document.head, preload);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {\n  ApplicationRef,\n  booleanAttribute,\n  ChangeDetectorRef,\n  DestroyRef,\n  Directive,\n  ElementRef,\n  ɵformatRuntimeError as formatRuntimeError,\n  ɵIMAGE_CONFIG as IMAGE_CONFIG,\n  ɵIMAGE_CONFIG_DEFAULTS as IMAGE_CONFIG_DEFAULTS,\n  ɵImageConfig as ImageConfig,\n  inject,\n  Injector,\n  Input,\n  NgZone,\n  numberAttribute,\n  OnChanges,\n  OnInit,\n  ɵperformanceMarkFeature as performanceMarkFeature,\n  Renderer2,\n  ɵRuntimeError as RuntimeError,\n  ɵSafeValue as SafeValue,\n  SimpleChanges,\n  ɵunwrapSafeValue as unwrapSafeValue,\n} from '@angular/core';\n\nimport {RuntimeErrorCode} from '../../errors';\n\nimport {imgDirectiveDetails} from './error_helper';\nimport {cloudinaryLoaderInfo} from './image_loaders/cloudinary_loader';\nimport {\n  IMAGE_LOADER,\n  ImageLoader,\n  ImageLoaderConfig,\n  noopImageLoader,\n} from './image_loaders/image_loader';\nimport {imageKitLoaderInfo} from './image_loaders/imagekit_loader';\nimport {imgixLoaderInfo} from './image_loaders/imgix_loader';\nimport {netlifyLoaderInfo} from './image_loaders/netlify_loader';\nimport {LCPImageObserver} from './lcp_image_observer';\nimport {PreconnectLinkChecker} from './preconnect_link_checker';\nimport {PreloadLinkCreator} from './preload-link-creator';\n\n/**\n * When a Base64-encoded image is passed as an input to the `NgOptimizedImage` directive,\n * an error is thrown. The image content (as a string) might be very long, thus making\n * it hard to read an error message if the entire string is included. This const defines\n * the number of characters that should be included into the error message. The rest\n * of the content is truncated.\n */\nconst BASE64_IMG_MAX_LENGTH_IN_ERROR = 50;\n\n/**\n * RegExpr to determine whether a src in a srcset is using width descriptors.\n * Should match something like: \"100w, 200w\".\n */\nconst VALID_WIDTH_DESCRIPTOR_SRCSET = /^((\\s*\\d+w\\s*(,|$)){1,})$/;\n\n/**\n * RegExpr to determine whether a src in a srcset is using density descriptors.\n * Should match something like: \"1x, 2x, 50x\". Also supports decimals like \"1.5x, 1.50x\".\n */\nconst VALID_DENSITY_DESCRIPTOR_SRCSET = /^((\\s*\\d+(\\.\\d+)?x\\s*(,|$)){1,})$/;\n\n/**\n * Srcset values with a density descriptor higher than this value will actively\n * throw an error. Such densities are not permitted as they cause image sizes\n * to be unreasonably large and slow down LCP.\n */\nexport const ABSOLUTE_SRCSET_DENSITY_CAP = 3;\n\n/**\n * Used only in error message text to communicate best practices, as we will\n * only throw based on the slightly more conservative ABSOLUTE_SRCSET_DENSITY_CAP.\n */\nexport const RECOMMENDED_SRCSET_DENSITY_CAP = 2;\n\n/**\n * Used in generating automatic density-based srcsets\n */\nconst DENSITY_SRCSET_MULTIPLIERS = [1, 2];\n\n/**\n * Used to determine which breakpoints to use on full-width images\n */\nconst VIEWPORT_BREAKPOINT_CUTOFF = 640;\n/**\n * Used to determine whether two aspect ratios are similar in value.\n */\nconst ASPECT_RATIO_TOLERANCE = 0.1;\n\n/**\n * Used to determine whether the image has been requested at an overly\n * large size compared to the actual rendered image size (after taking\n * into account a typical device pixel ratio). In pixels.\n */\nconst OVERSIZED_IMAGE_TOLERANCE = 1000;\n\n/**\n * Used to limit automatic srcset generation of very large sources for\n * fixed-size images. In pixels.\n */\nconst FIXED_SRCSET_WIDTH_LIMIT = 1920;\nconst FIXED_SRCSET_HEIGHT_LIMIT = 1080;\n\n/**\n * Placeholder dimension (height or width) limit in pixels. Angular produces a warning\n * when this limit is crossed.\n */\nconst PLACEHOLDER_DIMENSION_LIMIT = 1000;\n\n/**\n * Used to warn or error when the user provides an overly large dataURL for the placeholder\n * attribute.\n * Character count of Base64 images is 1 character per byte, and base64 encoding is approximately\n * 33% larger than base images, so 4000 characters is around 3KB on disk and 10000 characters is\n * around 7.7KB. Experimentally, 4000 characters is about 20x20px in PNG or medium-quality JPEG\n * format, and 10,000 is around 50x50px, but there's quite a bit of variation depending on how the\n * image is saved.\n */\nexport const DATA_URL_WARN_LIMIT = 4000;\nexport const DATA_URL_ERROR_LIMIT = 10000;\n\n/** Info about built-in loaders we can test for. */\nexport const BUILT_IN_LOADERS = [\n  imgixLoaderInfo,\n  imageKitLoaderInfo,\n  cloudinaryLoaderInfo,\n  netlifyLoaderInfo,\n];\n\n/**\n * Threshold for the PRIORITY_TRUE_COUNT\n */\nconst PRIORITY_COUNT_THRESHOLD = 10;\n\n/**\n * This count is used to log a devMode warning\n * when the count of directive instances with priority=true\n * exceeds the threshold PRIORITY_COUNT_THRESHOLD\n */\nlet IMGS_WITH_PRIORITY_ATTR_COUNT = 0;\n\n/**\n * This function is for testing purpose.\n */\nexport function resetImagePriorityCount() {\n  IMGS_WITH_PRIORITY_ATTR_COUNT = 0;\n}\n\n/**\n * Config options used in rendering placeholder images.\n *\n * @see {@link NgOptimizedImage}\n * @publicApi\n */\nexport interface ImagePlaceholderConfig {\n  blur?: boolean;\n}\n\n/**\n * Directive that improves image loading performance by enforcing best practices.\n *\n * `NgOptimizedImage` ensures that the loading of the Largest Contentful Paint (LCP) image is\n * prioritized by:\n * - Automatically setting the `fetchpriority` attribute on the `<img>` tag\n * - Lazy loading non-priority images by default\n * - Automatically generating a preconnect link tag in the document head\n *\n * In addition, the directive:\n * - Generates appropriate asset URLs if a corresponding `ImageLoader` function is provided\n * - Automatically generates a srcset\n * - Requires that `width` and `height` are set\n * - Warns if `width` or `height` have been set incorrectly\n * - Warns if the image will be visually distorted when rendered\n *\n * @usageNotes\n * The `NgOptimizedImage` directive is marked as [standalone](guide/components/importing) and can\n * be imported directly.\n *\n * Follow the steps below to enable and use the directive:\n * 1. Import it into the necessary NgModule or a standalone Component.\n * 2. Optionally provide an `ImageLoader` if you use an image hosting service.\n * 3. Update the necessary `<img>` tags in templates and replace `src` attributes with `ngSrc`.\n * Using a `ngSrc` allows the directive to control when the `src` gets set, which triggers an image\n * download.\n *\n * Step 1: import the `NgOptimizedImage` directive.\n *\n * ```ts\n * import { NgOptimizedImage } from '@angular/common';\n *\n * // Include it into the necessary NgModule\n * @NgModule({\n *   imports: [NgOptimizedImage],\n * })\n * class AppModule {}\n *\n * // ... or a standalone Component\n * @Component({\n *   imports: [NgOptimizedImage],\n * })\n * class MyStandaloneComponent {}\n * ```\n *\n * Step 2: configure a loader.\n *\n * To use the **default loader**: no additional code changes are necessary. The URL returned by the\n * generic loader will always match the value of \"src\". In other words, this loader applies no\n * transformations to the resource URL and the value of the `ngSrc` attribute will be used as is.\n *\n * To use an existing loader for a **third-party image service**: add the provider factory for your\n * chosen service to the `providers` array. In the example below, the Imgix loader is used:\n *\n * ```ts\n * import {provideImgixLoader} from '@angular/common';\n *\n * // Call the function and add the result to the `providers` array:\n * providers: [\n *   provideImgixLoader(\"https://my.base.url/\"),\n * ],\n * ```\n *\n * The `NgOptimizedImage` directive provides the following functions:\n * - `provideCloudflareLoader`\n * - `provideCloudinaryLoader`\n * - `provideImageKitLoader`\n * - `provideImgixLoader`\n *\n * If you use a different image provider, you can create a custom loader function as described\n * below.\n *\n * To use a **custom loader**: provide your loader function as a value for the `IMAGE_LOADER` DI\n * token.\n *\n * ```ts\n * import {IMAGE_LOADER, ImageLoaderConfig} from '@angular/common';\n *\n * // Configure the loader using the `IMAGE_LOADER` token.\n * providers: [\n *   {\n *      provide: IMAGE_LOADER,\n *      useValue: (config: ImageLoaderConfig) => {\n *        return `https://example.com/${config.src}-${config.width}.jpg`;\n *      }\n *   },\n * ],\n * ```\n *\n * Step 3: update `<img>` tags in templates to use `ngSrc` instead of `src`.\n *\n * ```html\n * <img ngSrc=\"logo.png\" width=\"200\" height=\"100\">\n * ```\n *\n * @publicApi\n * @see [Image Optimization Guide](guide/image-optimization)\n */\n@Directive({\n  selector: 'img[ngSrc]',\n  host: {\n    '[style.position]': 'fill ? \"absolute\" : null',\n    '[style.width]': 'fill ? \"100%\" : null',\n    '[style.height]': 'fill ? \"100%\" : null',\n    '[style.inset]': 'fill ? \"0\" : null',\n    '[style.background-size]': 'placeholder ? \"cover\" : null',\n    '[style.background-position]': 'placeholder ? \"50% 50%\" : null',\n    '[style.background-repeat]': 'placeholder ? \"no-repeat\" : null',\n    '[style.background-image]': 'placeholder ? generatePlaceholder(placeholder) : null',\n    '[style.filter]':\n      'placeholder && shouldBlurPlaceholder(placeholderConfig) ? \"blur(15px)\" : null',\n  },\n})\nexport class NgOptimizedImage implements OnInit, OnChanges {\n  private imageLoader = inject(IMAGE_LOADER);\n  private config: ImageConfig = processConfig(inject(IMAGE_CONFIG));\n  private renderer = inject(Renderer2);\n  private imgElement: HTMLImageElement = inject(ElementRef).nativeElement;\n  private injector = inject(Injector);\n  private destroyRef = inject(DestroyRef);\n\n  // An LCP image observer should be injected only in development mode.\n  // Do not assign it to `null` to avoid having a redundant property in the production bundle.\n  private lcpObserver?: LCPImageObserver;\n\n  /**\n   * Calculate the rewritten `src` once and store it.\n   * This is needed to avoid repetitive calculations and make sure the directive cleanup in the\n   * `ngOnDestroy` does not rely on the `IMAGE_LOADER` logic (which in turn can rely on some other\n   * instance that might be already destroyed).\n   */\n  private _renderedSrc: string | null = null;\n\n  /**\n   * Name of the source image.\n   * Image name will be processed by the image loader and the final URL will be applied as the `src`\n   * property of the image.\n   */\n  @Input({required: true, transform: unwrapSafeUrl}) ngSrc!: string;\n\n  /**\n   * A comma separated list of width or density descriptors.\n   * The image name will be taken from `ngSrc` and combined with the list of width or density\n   * descriptors to generate the final `srcset` property of the image.\n   *\n   * Example:\n   * ```html\n   * <img ngSrc=\"hello.jpg\" ngSrcset=\"100w, 200w\" />  =>\n   * <img src=\"path/hello.jpg\" srcset=\"path/hello.jpg?w=100 100w, path/hello.jpg?w=200 200w\" />\n   * ```\n   */\n  @Input() ngSrcset!: string;\n\n  /**\n   * The base `sizes` attribute passed through to the `<img>` element.\n   * Providing sizes causes the image to create an automatic responsive srcset.\n   */\n  @Input() sizes?: string;\n\n  /**\n   * For responsive images: the intrinsic width of the image in pixels.\n   * For fixed size images: the desired rendered width of the image in pixels.\n   */\n  @Input({transform: numberAttribute}) width: number | undefined;\n\n  /**\n   * For responsive images: the intrinsic height of the image in pixels.\n   * For fixed size images: the desired rendered height of the image in pixels.\n   */\n  @Input({transform: numberAttribute}) height: number | undefined;\n\n  /**\n   * The desired decoding behavior for the image. Defaults to `auto`\n   * if not explicitly set, matching native browser behavior.\n   *\n   * Use `async` to decode the image off the main thread (non-blocking),\n   * `sync` for immediate decoding (blocking), or `auto` to let the\n   * browser decide the optimal strategy.\n   *\n   * [Spec](https://html.spec.whatwg.org/multipage/images.html#image-decoding-hint)\n   */\n  @Input() decoding?: 'sync' | 'async' | 'auto';\n\n  /**\n   * The desired loading behavior (lazy, eager, or auto). Defaults to `lazy`,\n   * which is recommended for most images.\n   *\n   * Warning: Setting images as loading=\"eager\" or loading=\"auto\" marks them\n   * as non-priority images and can hurt loading performance. For images which\n   * may be the LCP element, use the `priority` attribute instead of `loading`.\n   */\n  @Input() loading?: 'lazy' | 'eager' | 'auto';\n\n  /**\n   * Indicates whether this image should have a high priority.\n   */\n  @Input({transform: booleanAttribute}) priority = false;\n\n  /**\n   * Data to pass through to custom loaders.\n   */\n  @Input() loaderParams?: {[key: string]: any};\n\n  /**\n   * Disables automatic srcset generation for this image.\n   */\n  @Input({transform: booleanAttribute}) disableOptimizedSrcset = false;\n\n  /**\n   * Sets the image to \"fill mode\", which eliminates the height/width requirement and adds\n   * styles such that the image fills its containing element.\n   */\n  @Input({transform: booleanAttribute}) fill = false;\n\n  /**\n   * A URL or data URL for an image to be used as a placeholder while this image loads.\n   */\n  @Input({transform: booleanOrUrlAttribute}) placeholder?: string | boolean;\n\n  /**\n   * Configuration object for placeholder settings. Options:\n   *   * blur: Setting this to false disables the automatic CSS blur.\n   */\n  @Input() placeholderConfig?: ImagePlaceholderConfig;\n\n  /**\n   * Value of the `src` attribute if set on the host `<img>` element.\n   * This input is exclusively read to assert that `src` is not set in conflict\n   * with `ngSrc` and that images don't start to load until a lazy loading strategy is set.\n   * @internal\n   */\n  @Input() src?: string;\n\n  /**\n   * Value of the `srcset` attribute if set on the host `<img>` element.\n   * This input is exclusively read to assert that `srcset` is not set in conflict\n   * with `ngSrcset` and that images don't start to load until a lazy loading strategy is set.\n   * @internal\n   */\n  @Input() srcset?: string;\n\n  constructor() {\n    if (ngDevMode) {\n      this.lcpObserver = this.injector.get(LCPImageObserver);\n\n      this.destroyRef.onDestroy(() => {\n        if (!this.priority && this._renderedSrc !== null) {\n          this.lcpObserver!.unregisterImage(this._renderedSrc);\n        }\n      });\n    }\n  }\n\n  /** @docs-private */\n  ngOnInit() {\n    performanceMarkFeature('NgOptimizedImage');\n\n    if (ngDevMode) {\n      const ngZone = this.injector.get(NgZone);\n      assertNonEmptyInput(this, 'ngSrc', this.ngSrc);\n      assertValidNgSrcset(this, this.ngSrcset);\n      assertNoConflictingSrc(this);\n      if (this.ngSrcset) {\n        assertNoConflictingSrcset(this);\n      }\n      assertNotBase64Image(this);\n      assertNotBlobUrl(this);\n      if (this.fill) {\n        assertEmptyWidthAndHeight(this);\n        // This leaves the Angular zone to avoid triggering unnecessary change detection cycles when\n        // `load` tasks are invoked on images.\n        ngZone.runOutsideAngular(() =>\n          assertNonZeroRenderedHeight(this, this.imgElement, this.renderer, this.destroyRef),\n        );\n      } else {\n        assertNonEmptyWidthAndHeight(this);\n        if (this.height !== undefined) {\n          assertGreaterThanZero(this, this.height, 'height');\n        }\n        if (this.width !== undefined) {\n          assertGreaterThanZero(this, this.width, 'width');\n        }\n        // Only check for distorted images when not in fill mode, where\n        // images may be intentionally stretched, cropped or letterboxed.\n        ngZone.runOutsideAngular(() =>\n          assertNoImageDistortion(this, this.imgElement, this.renderer, this.destroyRef),\n        );\n      }\n      assertValidLoadingInput(this);\n      assertValidDecodingInput(this);\n      if (!this.ngSrcset) {\n        assertNoComplexSizes(this);\n      }\n      assertValidPlaceholder(this, this.imageLoader);\n      assertNotMissingBuiltInLoader(this.ngSrc, this.imageLoader);\n      assertNoNgSrcsetWithoutLoader(this, this.imageLoader);\n      assertNoLoaderParamsWithoutLoader(this, this.imageLoader);\n\n      ngZone.runOutsideAngular(() => {\n        this.lcpObserver!.registerImage(this.getRewrittenSrc(), this.ngSrc, this.priority);\n      });\n\n      if (this.priority) {\n        const checker = this.injector.get(PreconnectLinkChecker);\n        checker.assertPreconnect(this.getRewrittenSrc(), this.ngSrc);\n\n        if (typeof ngServerMode !== 'undefined' && !ngServerMode) {\n          const applicationRef = this.injector.get(ApplicationRef);\n          assetPriorityCountBelowThreshold(applicationRef);\n        }\n      }\n    }\n    if (this.placeholder) {\n      this.removePlaceholderOnLoad(this.imgElement);\n    }\n    this.setHostAttributes();\n  }\n\n  private setHostAttributes() {\n    // Must set width/height explicitly in case they are bound (in which case they will\n    // only be reflected and not found by the browser)\n    if (this.fill) {\n      this.sizes ||= '100vw';\n    } else {\n      this.setHostAttribute('width', this.width!.toString());\n      this.setHostAttribute('height', this.height!.toString());\n    }\n\n    this.setHostAttribute('loading', this.getLoadingBehavior());\n    this.setHostAttribute('fetchpriority', this.getFetchPriority());\n    this.setHostAttribute('decoding', this.getDecoding());\n\n    // The `data-ng-img` attribute flags an image as using the directive, to allow\n    // for analysis of the directive's performance.\n    this.setHostAttribute('ng-img', 'true');\n\n    // The `src` and `srcset` attributes should be set last since other attributes\n    // could affect the image's loading behavior.\n    const rewrittenSrcset = this.updateSrcAndSrcset();\n\n    if (this.sizes) {\n      if (this.getLoadingBehavior() === 'lazy') {\n        this.setHostAttribute('sizes', 'auto, ' + this.sizes);\n      } else {\n        this.setHostAttribute('sizes', this.sizes);\n      }\n    } else {\n      if (\n        this.ngSrcset &&\n        VALID_WIDTH_DESCRIPTOR_SRCSET.test(this.ngSrcset) &&\n        this.getLoadingBehavior() === 'lazy'\n      ) {\n        this.setHostAttribute('sizes', 'auto, 100vw');\n      }\n    }\n\n    if (typeof ngServerMode !== 'undefined' && ngServerMode && this.priority) {\n      const preloadLinkCreator = this.injector.get(PreloadLinkCreator);\n      preloadLinkCreator.createPreloadLinkTag(\n        this.renderer,\n        this.getRewrittenSrc(),\n        rewrittenSrcset,\n        this.sizes,\n      );\n    }\n  }\n\n  /** @docs-private */\n  ngOnChanges(changes: SimpleChanges) {\n    if (ngDevMode) {\n      assertNoPostInitInputChange(this, changes, [\n        'ngSrcset',\n        'width',\n        'height',\n        'priority',\n        'fill',\n        'loading',\n        'sizes',\n        'loaderParams',\n        'disableOptimizedSrcset',\n      ]);\n    }\n    if (changes['ngSrc'] && !changes['ngSrc'].isFirstChange()) {\n      const oldSrc = this._renderedSrc;\n      this.updateSrcAndSrcset(true);\n\n      if (ngDevMode) {\n        const newSrc = this._renderedSrc;\n        if (oldSrc && newSrc && oldSrc !== newSrc) {\n          const ngZone = this.injector.get(NgZone);\n          ngZone.runOutsideAngular(() => {\n            this.lcpObserver!.updateImage(oldSrc, newSrc);\n          });\n        }\n      }\n    }\n\n    if (\n      ngDevMode &&\n      changes['placeholder']?.currentValue &&\n      typeof ngServerMode !== 'undefined' &&\n      !ngServerMode\n    ) {\n      assertPlaceholderDimensions(this, this.imgElement);\n    }\n  }\n\n  private callImageLoader(\n    configWithoutCustomParams: Omit<ImageLoaderConfig, 'loaderParams'>,\n  ): string {\n    let augmentedConfig: ImageLoaderConfig = configWithoutCustomParams;\n    if (this.loaderParams) {\n      augmentedConfig.loaderParams = this.loaderParams;\n    }\n    return this.imageLoader(augmentedConfig);\n  }\n\n  private getLoadingBehavior(): string {\n    if (!this.priority && this.loading !== undefined) {\n      return this.loading;\n    }\n    return this.priority ? 'eager' : 'lazy';\n  }\n\n  private getFetchPriority(): string {\n    return this.priority ? 'high' : 'auto';\n  }\n\n  private getDecoding(): string {\n    if (this.priority) {\n      // `sync` means the image is decoded immediately when it's loaded,\n      // reducing the risk of content shifting later (important for LCP).\n      // If we're marking an image as priority, we want it decoded and\n      // painted as early as possible.\n      return 'sync';\n    }\n    // Returns the value of the `decoding` attribute, defaulting to `auto`\n    // if not explicitly provided. This mimics native browser behavior and\n    // avoids breaking changes when no decoding strategy is specified.\n    return this.decoding ?? 'auto';\n  }\n\n  private getRewrittenSrc(): string {\n    // ImageLoaderConfig supports setting a width property. However, we're not setting width here\n    // because if the developer uses rendered width instead of intrinsic width in the HTML width\n    // attribute, the image requested may be too small for 2x+ screens.\n    if (!this._renderedSrc) {\n      const imgConfig = {src: this.ngSrc};\n      // Cache calculated image src to reuse it later in the code.\n      this._renderedSrc = this.callImageLoader(imgConfig);\n    }\n    return this._renderedSrc;\n  }\n\n  private getRewrittenSrcset(): string {\n    const widthSrcSet = VALID_WIDTH_DESCRIPTOR_SRCSET.test(this.ngSrcset);\n    const finalSrcs = this.ngSrcset\n      .split(',')\n      .filter((src) => src !== '')\n      .map((srcStr) => {\n        srcStr = srcStr.trim();\n        const width = widthSrcSet ? parseFloat(srcStr) : parseFloat(srcStr) * this.width!;\n        return `${this.callImageLoader({src: this.ngSrc, width})} ${srcStr}`;\n      });\n    return finalSrcs.join(', ');\n  }\n\n  private getAutomaticSrcset(): string {\n    if (this.sizes) {\n      return this.getResponsiveSrcset();\n    } else {\n      return this.getFixedSrcset();\n    }\n  }\n\n  private getResponsiveSrcset(): string {\n    const {breakpoints} = this.config;\n\n    let filteredBreakpoints = breakpoints!;\n    if (this.sizes?.trim() === '100vw') {\n      // Since this is a full-screen-width image, our srcset only needs to include\n      // breakpoints with full viewport widths.\n      filteredBreakpoints = breakpoints!.filter((bp) => bp >= VIEWPORT_BREAKPOINT_CUTOFF);\n    }\n\n    const finalSrcs = filteredBreakpoints.map(\n      (bp) => `${this.callImageLoader({src: this.ngSrc, width: bp})} ${bp}w`,\n    );\n    return finalSrcs.join(', ');\n  }\n\n  private updateSrcAndSrcset(forceSrcRecalc = false): string | undefined {\n    if (forceSrcRecalc) {\n      // Reset cached value, so that the followup `getRewrittenSrc()` call\n      // will recalculate it and update the cache.\n      this._renderedSrc = null;\n    }\n\n    const rewrittenSrc = this.getRewrittenSrc();\n    this.setHostAttribute('src', rewrittenSrc);\n\n    let rewrittenSrcset: string | undefined = undefined;\n    if (this.ngSrcset) {\n      rewrittenSrcset = this.getRewrittenSrcset();\n    } else if (this.shouldGenerateAutomaticSrcset()) {\n      rewrittenSrcset = this.getAutomaticSrcset();\n    }\n\n    if (rewrittenSrcset) {\n      this.setHostAttribute('srcset', rewrittenSrcset);\n    }\n    return rewrittenSrcset;\n  }\n\n  private getFixedSrcset(): string {\n    const finalSrcs = DENSITY_SRCSET_MULTIPLIERS.map(\n      (multiplier) =>\n        `${this.callImageLoader({\n          src: this.ngSrc,\n          width: this.width! * multiplier,\n        })} ${multiplier}x`,\n    );\n    return finalSrcs.join(', ');\n  }\n\n  private shouldGenerateAutomaticSrcset(): boolean {\n    let oversizedImage = false;\n    if (!this.sizes) {\n      oversizedImage =\n        this.width! > FIXED_SRCSET_WIDTH_LIMIT || this.height! > FIXED_SRCSET_HEIGHT_LIMIT;\n    }\n    return (\n      !this.disableOptimizedSrcset &&\n      !this.srcset &&\n      this.imageLoader !== noopImageLoader &&\n      !oversizedImage\n    );\n  }\n\n  /**\n   * Returns an image url formatted for use with the CSS background-image property. Expects one of:\n   * * A base64 encoded image, which is wrapped and passed through.\n   * * A boolean. If true, calls the image loader to generate a small placeholder url.\n   */\n  protected generatePlaceholder(placeholderInput: string | boolean): string | boolean | null {\n    const {placeholderResolution} = this.config;\n    if (placeholderInput === true) {\n      return `url(${this.callImageLoader({\n        src: this.ngSrc,\n        width: placeholderResolution,\n        isPlaceholder: true,\n      })})`;\n    } else if (typeof placeholderInput === 'string') {\n      return `url(${placeholderInput})`;\n    }\n    return null;\n  }\n\n  /**\n   * Determines if blur should be applied, based on an optional boolean\n   * property `blur` within the optional configuration object `placeholderConfig`.\n   */\n  protected shouldBlurPlaceholder(placeholderConfig?: ImagePlaceholderConfig): boolean {\n    if (!placeholderConfig || !placeholderConfig.hasOwnProperty('blur')) {\n      return true;\n    }\n    return Boolean(placeholderConfig.blur);\n  }\n\n  private removePlaceholderOnLoad(img: HTMLImageElement): void {\n    const callback = () => {\n      const changeDetectorRef = this.injector.get(ChangeDetectorRef);\n      removeLoadListenerFn();\n      removeErrorListenerFn();\n      this.placeholder = false;\n      changeDetectorRef.markForCheck();\n    };\n\n    const removeLoadListenerFn = this.renderer.listen(img, 'load', callback);\n    const removeErrorListenerFn = this.renderer.listen(img, 'error', callback);\n\n    // Clean up listeners once the view is destroyed, before the image\n    // loads or fails to load, to avoid element from being captured\n    // in memory and redundant change detection.\n    this.destroyRef.onDestroy(() => {\n      removeLoadListenerFn();\n      removeErrorListenerFn();\n    });\n\n    callOnLoadIfImageIsLoaded(img, callback);\n  }\n\n  private setHostAttribute(name: string, value: string): void {\n    this.renderer.setAttribute(this.imgElement, name, value);\n  }\n}\n\n/***** Helpers *****/\n\n/**\n * Sorts provided config breakpoints and uses defaults.\n */\nfunction processConfig(config: ImageConfig): ImageConfig {\n  let sortedBreakpoints: {breakpoints?: number[]} = {};\n  if (config.breakpoints) {\n    sortedBreakpoints.breakpoints = config.breakpoints.sort((a, b) => a - b);\n  }\n  return Object.assign({}, IMAGE_CONFIG_DEFAULTS, config, sortedBreakpoints);\n}\n\n/***** Assert functions *****/\n\n/**\n * Verifies that there is no `src` set on a host element.\n */\nfunction assertNoConflictingSrc(dir: NgOptimizedImage) {\n  if (dir.src) {\n    throw new RuntimeError(\n      RuntimeErrorCode.UNEXPECTED_SRC_ATTR,\n      `${imgDirectiveDetails(dir.ngSrc)} both \\`src\\` and \\`ngSrc\\` have been set. ` +\n        `Supplying both of these attributes breaks lazy loading. ` +\n        `The NgOptimizedImage directive sets \\`src\\` itself based on the value of \\`ngSrc\\`. ` +\n        `To fix this, please remove the \\`src\\` attribute.`,\n    );\n  }\n}\n\n/**\n * Verifies that there is no `srcset` set on a host element.\n */\nfunction assertNoConflictingSrcset(dir: NgOptimizedImage) {\n  if (dir.srcset) {\n    throw new RuntimeError(\n      RuntimeErrorCode.UNEXPECTED_SRCSET_ATTR,\n      `${imgDirectiveDetails(dir.ngSrc)} both \\`srcset\\` and \\`ngSrcset\\` have been set. ` +\n        `Supplying both of these attributes breaks lazy loading. ` +\n        `The NgOptimizedImage directive sets \\`srcset\\` itself based on the value of ` +\n        `\\`ngSrcset\\`. To fix this, please remove the \\`srcset\\` attribute.`,\n    );\n  }\n}\n\n/**\n * Verifies that the `ngSrc` is not a Base64-encoded image.\n */\nfunction assertNotBase64Image(dir: NgOptimizedImage) {\n  let ngSrc = dir.ngSrc.trim();\n  if (ngSrc.startsWith('data:')) {\n    if (ngSrc.length > BASE64_IMG_MAX_LENGTH_IN_ERROR) {\n      ngSrc = ngSrc.substring(0, BASE64_IMG_MAX_LENGTH_IN_ERROR) + '...';\n    }\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc, false)} \\`ngSrc\\` is a Base64-encoded string ` +\n        `(${ngSrc}). NgOptimizedImage does not support Base64-encoded strings. ` +\n        `To fix this, disable the NgOptimizedImage directive for this element ` +\n        `by removing \\`ngSrc\\` and using a standard \\`src\\` attribute instead.`,\n    );\n  }\n}\n\n/**\n * Verifies that the 'sizes' only includes responsive values.\n */\nfunction assertNoComplexSizes(dir: NgOptimizedImage) {\n  let sizes = dir.sizes;\n  if (sizes?.match(/((\\)|,)\\s|^)\\d+px/)) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc, false)} \\`sizes\\` was set to a string including ` +\n        `pixel values. For automatic \\`srcset\\` generation, \\`sizes\\` must only include responsive ` +\n        `values, such as \\`sizes=\"50vw\"\\` or \\`sizes=\"(min-width: 768px) 50vw, 100vw\"\\`. ` +\n        `To fix this, modify the \\`sizes\\` attribute, or provide your own \\`ngSrcset\\` value directly.`,\n    );\n  }\n}\n\nfunction assertValidPlaceholder(dir: NgOptimizedImage, imageLoader: ImageLoader) {\n  assertNoPlaceholderConfigWithoutPlaceholder(dir);\n  assertNoRelativePlaceholderWithoutLoader(dir, imageLoader);\n  assertNoOversizedDataUrl(dir);\n}\n\n/**\n * Verifies that placeholderConfig isn't being used without placeholder\n */\nfunction assertNoPlaceholderConfigWithoutPlaceholder(dir: NgOptimizedImage) {\n  if (dir.placeholderConfig && !dir.placeholder) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(\n        dir.ngSrc,\n        false,\n      )} \\`placeholderConfig\\` options were provided for an ` +\n        `image that does not use the \\`placeholder\\` attribute, and will have no effect.`,\n    );\n  }\n}\n\n/**\n * Warns if a relative URL placeholder is specified, but no loader is present to provide the small\n * image.\n */\nfunction assertNoRelativePlaceholderWithoutLoader(dir: NgOptimizedImage, imageLoader: ImageLoader) {\n  if (dir.placeholder === true && imageLoader === noopImageLoader) {\n    throw new RuntimeError(\n      RuntimeErrorCode.MISSING_NECESSARY_LOADER,\n      `${imgDirectiveDetails(dir.ngSrc)} the \\`placeholder\\` attribute is set to true but ` +\n        `no image loader is configured (i.e. the default one is being used), ` +\n        `which would result in the same image being used for the primary image and its placeholder. ` +\n        `To fix this, provide a loader or remove the \\`placeholder\\` attribute from the image.`,\n    );\n  }\n}\n\n/**\n * Warns or throws an error if an oversized dataURL placeholder is provided.\n */\nfunction assertNoOversizedDataUrl(dir: NgOptimizedImage) {\n  if (\n    dir.placeholder &&\n    typeof dir.placeholder === 'string' &&\n    dir.placeholder.startsWith('data:')\n  ) {\n    if (dir.placeholder.length > DATA_URL_ERROR_LIMIT) {\n      throw new RuntimeError(\n        RuntimeErrorCode.OVERSIZED_PLACEHOLDER,\n        `${imgDirectiveDetails(\n          dir.ngSrc,\n        )} the \\`placeholder\\` attribute is set to a data URL which is longer ` +\n          `than ${DATA_URL_ERROR_LIMIT} characters. This is strongly discouraged, as large inline placeholders ` +\n          `directly increase the bundle size of Angular and hurt page load performance. To fix this, generate ` +\n          `a smaller data URL placeholder.`,\n      );\n    }\n    if (dir.placeholder.length > DATA_URL_WARN_LIMIT) {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.OVERSIZED_PLACEHOLDER,\n          `${imgDirectiveDetails(\n            dir.ngSrc,\n          )} the \\`placeholder\\` attribute is set to a data URL which is longer ` +\n            `than ${DATA_URL_WARN_LIMIT} characters. This is discouraged, as large inline placeholders ` +\n            `directly increase the bundle size of Angular and hurt page load performance. For better loading performance, ` +\n            `generate a smaller data URL placeholder.`,\n        ),\n      );\n    }\n  }\n}\n\n/**\n * Verifies that the `ngSrc` is not a Blob URL.\n */\nfunction assertNotBlobUrl(dir: NgOptimizedImage) {\n  const ngSrc = dir.ngSrc.trim();\n  if (ngSrc.startsWith('blob:')) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} \\`ngSrc\\` was set to a blob URL (${ngSrc}). ` +\n        `Blob URLs are not supported by the NgOptimizedImage directive. ` +\n        `To fix this, disable the NgOptimizedImage directive for this element ` +\n        `by removing \\`ngSrc\\` and using a regular \\`src\\` attribute instead.`,\n    );\n  }\n}\n\n/**\n * Verifies that the input is set to a non-empty string.\n */\nfunction assertNonEmptyInput(dir: NgOptimizedImage, name: string, value: unknown) {\n  const isString = typeof value === 'string';\n  const isEmptyString = isString && value.trim() === '';\n  if (!isString || isEmptyString) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} \\`${name}\\` has an invalid value ` +\n        `(\\`${value}\\`). To fix this, change the value to a non-empty string.`,\n    );\n  }\n}\n\n/**\n * Verifies that the `ngSrcset` is in a valid format, e.g. \"100w, 200w\" or \"1x, 2x\".\n */\nexport function assertValidNgSrcset(dir: NgOptimizedImage, value: unknown) {\n  if (value == null) return;\n  assertNonEmptyInput(dir, 'ngSrcset', value);\n  const stringVal = value as string;\n  const isValidWidthDescriptor = VALID_WIDTH_DESCRIPTOR_SRCSET.test(stringVal);\n  const isValidDensityDescriptor = VALID_DENSITY_DESCRIPTOR_SRCSET.test(stringVal);\n\n  if (isValidDensityDescriptor) {\n    assertUnderDensityCap(dir, stringVal);\n  }\n\n  const isValidSrcset = isValidWidthDescriptor || isValidDensityDescriptor;\n  if (!isValidSrcset) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} \\`ngSrcset\\` has an invalid value (\\`${value}\\`). ` +\n        `To fix this, supply \\`ngSrcset\\` using a comma-separated list of one or more width ` +\n        `descriptors (e.g. \"100w, 200w\") or density descriptors (e.g. \"1x, 2x\").`,\n    );\n  }\n}\n\nfunction assertUnderDensityCap(dir: NgOptimizedImage, value: string) {\n  const underDensityCap = value\n    .split(',')\n    .every((num) => num === '' || parseFloat(num) <= ABSOLUTE_SRCSET_DENSITY_CAP);\n  if (!underDensityCap) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} the \\`ngSrcset\\` contains an unsupported image density:` +\n        `\\`${value}\\`. NgOptimizedImage generally recommends a max image density of ` +\n        `${RECOMMENDED_SRCSET_DENSITY_CAP}x but supports image densities up to ` +\n        `${ABSOLUTE_SRCSET_DENSITY_CAP}x. The human eye cannot distinguish between image densities ` +\n        `greater than ${RECOMMENDED_SRCSET_DENSITY_CAP}x - which makes them unnecessary for ` +\n        `most use cases. Images that will be pinch-zoomed are typically the primary use case for ` +\n        `${ABSOLUTE_SRCSET_DENSITY_CAP}x images. Please remove the high density descriptor and try again.`,\n    );\n  }\n}\n\n/**\n * Creates a `RuntimeError` instance to represent a situation when an input is set after\n * the directive has initialized.\n */\nfunction postInitInputChangeError(dir: NgOptimizedImage, inputName: string): {} {\n  let reason!: string;\n  if (inputName === 'width' || inputName === 'height') {\n    reason =\n      `Changing \\`${inputName}\\` may result in different attribute value ` +\n      `applied to the underlying image element and cause layout shifts on a page.`;\n  } else {\n    reason =\n      `Changing the \\`${inputName}\\` would have no effect on the underlying ` +\n      `image element, because the resource loading has already occurred.`;\n  }\n  return new RuntimeError(\n    RuntimeErrorCode.UNEXPECTED_INPUT_CHANGE,\n    `${imgDirectiveDetails(dir.ngSrc)} \\`${inputName}\\` was updated after initialization. ` +\n      `The NgOptimizedImage directive will not react to this input change. ${reason} ` +\n      `To fix this, either switch \\`${inputName}\\` to a static value ` +\n      `or wrap the image element in an @if that is gated on the necessary value.`,\n  );\n}\n\n/**\n * Verify that none of the listed inputs has changed.\n */\nfunction assertNoPostInitInputChange(\n  dir: NgOptimizedImage,\n  changes: SimpleChanges,\n  inputs: string[],\n) {\n  inputs.forEach((input) => {\n    const isUpdated = changes.hasOwnProperty(input);\n    if (isUpdated && !changes[input].isFirstChange()) {\n      if (input === 'ngSrc') {\n        // When the `ngSrc` input changes, we detect that only in the\n        // `ngOnChanges` hook, thus the `ngSrc` is already set. We use\n        // `ngSrc` in the error message, so we use a previous value, but\n        // not the updated one in it.\n        dir = {ngSrc: changes[input].previousValue} as NgOptimizedImage;\n      }\n      throw postInitInputChangeError(dir, input);\n    }\n  });\n}\n\n/**\n * Verifies that a specified input is a number greater than 0.\n */\nfunction assertGreaterThanZero(dir: NgOptimizedImage, inputValue: unknown, inputName: string) {\n  const validNumber = typeof inputValue === 'number' && inputValue > 0;\n  const validString =\n    typeof inputValue === 'string' && /^\\d+$/.test(inputValue.trim()) && parseInt(inputValue) > 0;\n  if (!validNumber && !validString) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} \\`${inputName}\\` has an invalid value. ` +\n        `To fix this, provide \\`${inputName}\\` as a number greater than 0.`,\n    );\n  }\n}\n\n/**\n * Verifies that the rendered image is not visually distorted. Effectively this is checking:\n * - Whether the \"width\" and \"height\" attributes reflect the actual dimensions of the image.\n * - Whether image styling is \"correct\" (see below for a longer explanation).\n */\nfunction assertNoImageDistortion(\n  dir: NgOptimizedImage,\n  img: HTMLImageElement,\n  renderer: Renderer2,\n  destroyRef: DestroyRef,\n) {\n  const callback = () => {\n    removeLoadListenerFn();\n    removeErrorListenerFn();\n    const computedStyle = window.getComputedStyle(img);\n    let renderedWidth = parseFloat(computedStyle.getPropertyValue('width'));\n    let renderedHeight = parseFloat(computedStyle.getPropertyValue('height'));\n    const boxSizing = computedStyle.getPropertyValue('box-sizing');\n\n    if (boxSizing === 'border-box') {\n      const paddingTop = computedStyle.getPropertyValue('padding-top');\n      const paddingRight = computedStyle.getPropertyValue('padding-right');\n      const paddingBottom = computedStyle.getPropertyValue('padding-bottom');\n      const paddingLeft = computedStyle.getPropertyValue('padding-left');\n      renderedWidth -= parseFloat(paddingRight) + parseFloat(paddingLeft);\n      renderedHeight -= parseFloat(paddingTop) + parseFloat(paddingBottom);\n    }\n\n    const renderedAspectRatio = renderedWidth / renderedHeight;\n    const nonZeroRenderedDimensions = renderedWidth !== 0 && renderedHeight !== 0;\n\n    const intrinsicWidth = img.naturalWidth;\n    const intrinsicHeight = img.naturalHeight;\n    const intrinsicAspectRatio = intrinsicWidth / intrinsicHeight;\n\n    const suppliedWidth = dir.width!;\n    const suppliedHeight = dir.height!;\n    const suppliedAspectRatio = suppliedWidth / suppliedHeight;\n\n    // Tolerance is used to account for the impact of subpixel rendering.\n    // Due to subpixel rendering, the rendered, intrinsic, and supplied\n    // aspect ratios of a correctly configured image may not exactly match.\n    // For example, a `width=4030 height=3020` image might have a rendered\n    // size of \"1062w, 796.48h\". (An aspect ratio of 1.334... vs. 1.333...)\n    const inaccurateDimensions =\n      Math.abs(suppliedAspectRatio - intrinsicAspectRatio) > ASPECT_RATIO_TOLERANCE;\n    const stylingDistortion =\n      nonZeroRenderedDimensions &&\n      Math.abs(intrinsicAspectRatio - renderedAspectRatio) > ASPECT_RATIO_TOLERANCE;\n\n    if (inaccurateDimensions) {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.INVALID_INPUT,\n          `${imgDirectiveDetails(dir.ngSrc)} the aspect ratio of the image does not match ` +\n            `the aspect ratio indicated by the width and height attributes. ` +\n            `\\nIntrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n            `(aspect-ratio: ${round(\n              intrinsicAspectRatio,\n            )}). \\nSupplied width and height attributes: ` +\n            `${suppliedWidth}w x ${suppliedHeight}h (aspect-ratio: ${round(\n              suppliedAspectRatio,\n            )}). ` +\n            `\\nTo fix this, update the width and height attributes.`,\n        ),\n      );\n    } else if (stylingDistortion) {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.INVALID_INPUT,\n          `${imgDirectiveDetails(dir.ngSrc)} the aspect ratio of the rendered image ` +\n            `does not match the image's intrinsic aspect ratio. ` +\n            `\\nIntrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h ` +\n            `(aspect-ratio: ${round(intrinsicAspectRatio)}). \\nRendered image size: ` +\n            `${renderedWidth}w x ${renderedHeight}h (aspect-ratio: ` +\n            `${round(renderedAspectRatio)}). \\nThis issue can occur if \"width\" and \"height\" ` +\n            `attributes are added to an image without updating the corresponding ` +\n            `image styling. To fix this, adjust image styling. In most cases, ` +\n            `adding \"height: auto\" or \"width: auto\" to the image styling will fix ` +\n            `this issue.`,\n        ),\n      );\n    } else if (!dir.ngSrcset && nonZeroRenderedDimensions) {\n      // If `ngSrcset` hasn't been set, sanity check the intrinsic size.\n      const recommendedWidth = RECOMMENDED_SRCSET_DENSITY_CAP * renderedWidth;\n      const recommendedHeight = RECOMMENDED_SRCSET_DENSITY_CAP * renderedHeight;\n      const oversizedWidth = intrinsicWidth - recommendedWidth >= OVERSIZED_IMAGE_TOLERANCE;\n      const oversizedHeight = intrinsicHeight - recommendedHeight >= OVERSIZED_IMAGE_TOLERANCE;\n      if (oversizedWidth || oversizedHeight) {\n        console.warn(\n          formatRuntimeError(\n            RuntimeErrorCode.OVERSIZED_IMAGE,\n            `${imgDirectiveDetails(dir.ngSrc)} the intrinsic image is significantly ` +\n              `larger than necessary. ` +\n              `\\nRendered image size: ${renderedWidth}w x ${renderedHeight}h. ` +\n              `\\nIntrinsic image size: ${intrinsicWidth}w x ${intrinsicHeight}h. ` +\n              `\\nRecommended intrinsic image size: ${recommendedWidth}w x ${recommendedHeight}h. ` +\n              `\\nNote: Recommended intrinsic image size is calculated assuming a maximum DPR of ` +\n              `${RECOMMENDED_SRCSET_DENSITY_CAP}. To improve loading time, resize the image ` +\n              `or consider using the \"ngSrcset\" and \"sizes\" attributes.`,\n          ),\n        );\n      }\n    }\n  };\n\n  const removeLoadListenerFn = renderer.listen(img, 'load', callback);\n\n  // We only listen to the `error` event to remove the `load` event listener because it will not be\n  // fired if the image fails to load. This is done to prevent memory leaks in development mode\n  // because image elements aren't garbage-collected properly. It happens because zone.js stores the\n  // event listener directly on the element and closures capture `dir`.\n  const removeErrorListenerFn = renderer.listen(img, 'error', () => {\n    removeLoadListenerFn();\n    removeErrorListenerFn();\n  });\n\n  // Clean up listeners once the view is destroyed, before the image\n  // loads or fails to load, to avoid element from being captured\n  // in memory and redundant change detection.\n  destroyRef.onDestroy(() => {\n    removeLoadListenerFn();\n    removeErrorListenerFn();\n  });\n\n  callOnLoadIfImageIsLoaded(img, callback);\n}\n\n/**\n * Verifies that a specified input is set.\n */\nfunction assertNonEmptyWidthAndHeight(dir: NgOptimizedImage) {\n  let missingAttributes = [];\n  if (dir.width === undefined) missingAttributes.push('width');\n  if (dir.height === undefined) missingAttributes.push('height');\n  if (missingAttributes.length > 0) {\n    throw new RuntimeError(\n      RuntimeErrorCode.REQUIRED_INPUT_MISSING,\n      `${imgDirectiveDetails(dir.ngSrc)} these required attributes ` +\n        `are missing: ${missingAttributes.map((attr) => `\"${attr}\"`).join(', ')}. ` +\n        `Including \"width\" and \"height\" attributes will prevent image-related layout shifts. ` +\n        `To fix this, include \"width\" and \"height\" attributes on the image tag or turn on ` +\n        `\"fill\" mode with the \\`fill\\` attribute.`,\n    );\n  }\n}\n\n/**\n * Verifies that width and height are not set. Used in fill mode, where those attributes don't make\n * sense.\n */\nfunction assertEmptyWidthAndHeight(dir: NgOptimizedImage) {\n  if (dir.width || dir.height) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} the attributes \\`height\\` and/or \\`width\\` are present ` +\n        `along with the \\`fill\\` attribute. Because \\`fill\\` mode causes an image to fill its containing ` +\n        `element, the size attributes have no effect and should be removed.`,\n    );\n  }\n}\n\n/**\n * Verifies that the rendered image has a nonzero height. If the image is in fill mode, provides\n * guidance that this can be caused by the containing element's CSS position property.\n */\nfunction assertNonZeroRenderedHeight(\n  dir: NgOptimizedImage,\n  img: HTMLImageElement,\n  renderer: Renderer2,\n  destroyRef: DestroyRef,\n) {\n  const callback = () => {\n    removeLoadListenerFn();\n    removeErrorListenerFn();\n    const renderedHeight = img.clientHeight;\n    if (dir.fill && renderedHeight === 0) {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.INVALID_INPUT,\n          `${imgDirectiveDetails(dir.ngSrc)} the height of the fill-mode image is zero. ` +\n            `This is likely because the containing element does not have the CSS 'position' ` +\n            `property set to one of the following: \"relative\", \"fixed\", or \"absolute\". ` +\n            `To fix this problem, make sure the container element has the CSS 'position' ` +\n            `property defined and the height of the element is not zero.`,\n        ),\n      );\n    }\n  };\n\n  const removeLoadListenerFn = renderer.listen(img, 'load', callback);\n\n  // See comments in the `assertNoImageDistortion`.\n  const removeErrorListenerFn = renderer.listen(img, 'error', () => {\n    removeLoadListenerFn();\n    removeErrorListenerFn();\n  });\n\n  // Clean up listeners once the view is destroyed, before the image\n  // loads or fails to load, to avoid element from being captured\n  // in memory and redundant change detection.\n  destroyRef.onDestroy(() => {\n    removeLoadListenerFn();\n    removeErrorListenerFn();\n  });\n\n  callOnLoadIfImageIsLoaded(img, callback);\n}\n\n/**\n * Verifies that the `loading` attribute is set to a valid input &\n * is not used on priority images.\n */\nfunction assertValidLoadingInput(dir: NgOptimizedImage) {\n  if (dir.loading && dir.priority) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} the \\`loading\\` attribute ` +\n        `was used on an image that was marked \"priority\". ` +\n        `Setting \\`loading\\` on priority images is not allowed ` +\n        `because these images will always be eagerly loaded. ` +\n        `To fix this, remove the “loading” attribute from the priority image.`,\n    );\n  }\n  const validInputs = ['auto', 'eager', 'lazy'];\n  if (typeof dir.loading === 'string' && !validInputs.includes(dir.loading)) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} the \\`loading\\` attribute ` +\n        `has an invalid value (\\`${dir.loading}\\`). ` +\n        `To fix this, provide a valid value (\"lazy\", \"eager\", or \"auto\").`,\n    );\n  }\n}\n\n/**\n * Verifies that the `decoding` attribute is set to a valid input.\n */\nfunction assertValidDecodingInput(dir: NgOptimizedImage) {\n  const validInputs = ['sync', 'async', 'auto'];\n  if (typeof dir.decoding === 'string' && !validInputs.includes(dir.decoding)) {\n    throw new RuntimeError(\n      RuntimeErrorCode.INVALID_INPUT,\n      `${imgDirectiveDetails(dir.ngSrc)} the \\`decoding\\` attribute ` +\n        `has an invalid value (\\`${dir.decoding}\\`). ` +\n        `To fix this, provide a valid value (\"sync\", \"async\", or \"auto\").`,\n    );\n  }\n}\n\n/**\n * Warns if NOT using a loader (falling back to the generic loader) and\n * the image appears to be hosted on one of the image CDNs for which\n * we do have a built-in image loader. Suggests switching to the\n * built-in loader.\n *\n * @param ngSrc Value of the ngSrc attribute\n * @param imageLoader ImageLoader provided\n */\nfunction assertNotMissingBuiltInLoader(ngSrc: string, imageLoader: ImageLoader) {\n  if (imageLoader === noopImageLoader) {\n    let builtInLoaderName = '';\n    for (const loader of BUILT_IN_LOADERS) {\n      if (loader.testUrl(ngSrc)) {\n        builtInLoaderName = loader.name;\n        break;\n      }\n    }\n    if (builtInLoaderName) {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.MISSING_BUILTIN_LOADER,\n          `NgOptimizedImage: It looks like your images may be hosted on the ` +\n            `${builtInLoaderName} CDN, but your app is not using Angular's ` +\n            `built-in loader for that CDN. We recommend switching to use ` +\n            `the built-in by calling \\`provide${builtInLoaderName}Loader()\\` ` +\n            `in your \\`providers\\` and passing it your instance's base URL. ` +\n            `If you don't want to use the built-in loader, define a custom ` +\n            `loader function using IMAGE_LOADER to silence this warning.`,\n        ),\n      );\n    }\n  }\n}\n\n/**\n * Warns if ngSrcset is present and no loader is configured (i.e. the default one is being used).\n */\nfunction assertNoNgSrcsetWithoutLoader(dir: NgOptimizedImage, imageLoader: ImageLoader) {\n  if (dir.ngSrcset && imageLoader === noopImageLoader) {\n    console.warn(\n      formatRuntimeError(\n        RuntimeErrorCode.MISSING_NECESSARY_LOADER,\n        `${imgDirectiveDetails(dir.ngSrc)} the \\`ngSrcset\\` attribute is present but ` +\n          `no image loader is configured (i.e. the default one is being used), ` +\n          `which would result in the same image being used for all configured sizes. ` +\n          `To fix this, provide a loader or remove the \\`ngSrcset\\` attribute from the image.`,\n      ),\n    );\n  }\n}\n\n/**\n * Warns if loaderParams is present and no loader is configured (i.e. the default one is being\n * used).\n */\nfunction assertNoLoaderParamsWithoutLoader(dir: NgOptimizedImage, imageLoader: ImageLoader) {\n  if (dir.loaderParams && imageLoader === noopImageLoader) {\n    console.warn(\n      formatRuntimeError(\n        RuntimeErrorCode.MISSING_NECESSARY_LOADER,\n        `${imgDirectiveDetails(dir.ngSrc)} the \\`loaderParams\\` attribute is present but ` +\n          `no image loader is configured (i.e. the default one is being used), ` +\n          `which means that the loaderParams data will not be consumed and will not affect the URL. ` +\n          `To fix this, provide a custom loader or remove the \\`loaderParams\\` attribute from the image.`,\n      ),\n    );\n  }\n}\n\n/**\n * Warns if the priority attribute is used too often on page load\n */\nasync function assetPriorityCountBelowThreshold(appRef: ApplicationRef) {\n  if (IMGS_WITH_PRIORITY_ATTR_COUNT === 0) {\n    IMGS_WITH_PRIORITY_ATTR_COUNT++;\n    await appRef.whenStable();\n    if (IMGS_WITH_PRIORITY_ATTR_COUNT > PRIORITY_COUNT_THRESHOLD) {\n      console.warn(\n        formatRuntimeError(\n          RuntimeErrorCode.TOO_MANY_PRIORITY_ATTRIBUTES,\n          `NgOptimizedImage: The \"priority\" attribute is set to true more than ${PRIORITY_COUNT_THRESHOLD} times (${IMGS_WITH_PRIORITY_ATTR_COUNT} times). ` +\n            `Marking too many images as \"high\" priority can hurt your application's LCP (https://web.dev/lcp). ` +\n            `\"Priority\" should only be set on the image expected to be the page's LCP element.`,\n        ),\n      );\n    }\n  } else {\n    IMGS_WITH_PRIORITY_ATTR_COUNT++;\n  }\n}\n\n/**\n * Warns if placeholder's dimension are over a threshold.\n *\n * This assert function is meant to only run on the browser.\n */\nfunction assertPlaceholderDimensions(dir: NgOptimizedImage, imgElement: HTMLImageElement) {\n  const computedStyle = window.getComputedStyle(imgElement);\n  let renderedWidth = parseFloat(computedStyle.getPropertyValue('width'));\n  let renderedHeight = parseFloat(computedStyle.getPropertyValue('height'));\n\n  if (renderedWidth > PLACEHOLDER_DIMENSION_LIMIT || renderedHeight > PLACEHOLDER_DIMENSION_LIMIT) {\n    console.warn(\n      formatRuntimeError(\n        RuntimeErrorCode.PLACEHOLDER_DIMENSION_LIMIT_EXCEEDED,\n        `${imgDirectiveDetails(dir.ngSrc)} it uses a placeholder image, but at least one ` +\n          `of the dimensions attribute (height or width) exceeds the limit of ${PLACEHOLDER_DIMENSION_LIMIT}px. ` +\n          `To fix this, use a smaller image as a placeholder.`,\n      ),\n    );\n  }\n}\n\nfunction callOnLoadIfImageIsLoaded(img: HTMLImageElement, callback: VoidFunction): void {\n  // https://html.spec.whatwg.org/multipage/embedded-content.html#dom-img-complete\n  // The spec defines that `complete` is truthy once its request state is fully available.\n  // The image may already be available if it’s loaded from the browser cache.\n  // In that case, the `load` event will not fire at all, meaning that all setup\n  // callbacks listening for the `load` event will not be invoked.\n  // In Safari, there is a known behavior where the `complete` property of an\n  // `HTMLImageElement` may sometimes return `true` even when the image is not fully loaded.\n  // Checking both `img.complete` and `img.naturalWidth` is the most reliable way to\n  // determine if an image has been fully loaded, especially in browsers where the\n  // `complete` property may return `true` prematurely.\n  if (img.complete && img.naturalWidth) {\n    callback();\n  }\n}\n\nfunction round(input: number): number | string {\n  return Number.isInteger(input) ? input : input.toFixed(2);\n}\n\n// Transform function to handle SafeValue input for ngSrc. This doesn't do any sanitization,\n// as that is not needed for img.src and img.srcset. This transform is purely for compatibility.\nfunction unwrapSafeUrl(value: string | SafeValue): string {\n  if (typeof value === 'string') {\n    return value;\n  }\n  return unwrapSafeValue(value);\n}\n\n// Transform function to handle inputs which may be booleans, strings, or string representations\n// of boolean values. Used for the placeholder attribute.\nexport function booleanOrUrlAttribute(value: boolean | string): boolean | string {\n  if (typeof value === 'string' && value !== 'true' && value !== 'false' && value !== '') {\n    return value;\n  }\n  return booleanAttribute(value);\n}\n"],"names":["NavigationAdapterForLocation","Location","navigation","inject","PlatformNavigation","destroyRef","DestroyRef","constructor","LocationStrategy","registerNavigationListeners","currentEntryChangeListener","_notifyUrlChangeListeners","path","getState","addEventListener","onDestroy","removeEventListener","currentEntry","replaceState","query","state","url","prepareExternalUrl","normalizeQueryParams","navigate","history","go","back","forward","onUrlChange","fn","_urlChangeListeners","push","fnIndex","indexOf","splice","deps","target","i0","ɵɵFactoryTarget","Injectable","decorators","registerLocaleData","data","localeId","extraData","ɵregisterLocaleData","PLATFORM_BROWSER_ID","PLATFORM_SERVER_ID","isPlatformBrowser","platformId","isPlatformServer","VERSION","Version","ViewportScroller","ɵprov","ɵɵdefineInjectable","token","providedIn","factory","ngServerMode","NullViewportScroller","BrowserViewportScroller","DOCUMENT","window","document","offset","setOffset","Array","isArray","getScrollPosition","scrollX","scrollY","scrollToPosition","position","options","scrollTo","left","top","scrollToAnchor","elSelected","findAnchorFromDocument","scrollToElement","focus","setHistoryScrollRestoration","scrollRestoration","console","warn","formatRuntimeError","ngDevMode","el","rect","getBoundingClientRect","pageXOffset","pageYOffset","documentResult","getElementById","getElementsByName","createTreeWalker","body","attachShadow","treeWalker","NodeFilter","SHOW_ELEMENT","currentNode","shadowRoot","result","querySelector","nextNode","anchor","PLACEHOLDER_QUALITY","getUrl","src","win","isAbsoluteUrl","URL","location","href","test","extractHostname","hostname","isValidPath","isString","trim","normalizePath","endsWith","slice","normalizeSrc","startsWith","noopImageLoader","config","IMAGE_LOADER","InjectionToken","createImageLoader","buildUrlFn","exampleUrls","provideImageLoader","throwInvalidPathError","loaderFn","throwUnexpectedAbsoluteUrlError","providers","provide","useValue","RuntimeError","join","provideCloudflareLoader","createCloudflareUrl","undefined","params","width","isPlaceholder","cloudinaryLoaderInfo","name","testUrl","isCloudinaryUrl","CLOUDINARY_LOADER_REGEX","provideCloudinaryLoader","createCloudinaryUrl","quality","loaderParams","imageKitLoaderInfo","isImageKitUrl","IMAGE_KIT_LOADER_REGEX","provideImageKitLoader","createImagekitUrl","urlSegments","length","imgixLoaderInfo","isImgixUrl","IMGIX_LOADER_REGEX","provideImgixLoader","createImgixUrl","searchParams","set","toString","netlifyLoaderInfo","isNetlifyUrl","NETLIFY_LOADER_REGEX","provideNetlifyLoader","origin","createNetlifyUrl","validParams","Map","pathname","configQuality","param","value","Object","entries","has","get","replace","imgDirectiveDetails","ngSrc","includeNgSrc","ngSrcInfo","assertDevMode","checkName","LCPImageObserver","images","defaultView","observer","PerformanceObserver","initPerformanceObserver","entryList","getEntries","lcpElement","imgSrc","element","img","priority","alreadyWarnedPriority","logMissingPriorityError","modified","alreadyWarnedModified","logModifiedWarning","observe","type","buffered","registerImage","rewrittenSrc","originalNgSrc","isPriority","newObservedImageState","unregisterImage","delete","updateImage","originalSrc","newSrc","originalUrl","ngOnDestroy","disconnect","clear","ɵɵngDeclareInjectable","minVersion","version","ngImport","directiveDetails","error","INTERNAL_PRECONNECT_CHECK_BLOCKLIST","Set","PRECONNECT_CHECK_BLOCKLIST","PreconnectLinkChecker","preconnectLinks","alreadySeen","blocklist","optional","populateBlocklist","origins","deepForEach","add","assertPreconnect","imgUrl","queryPreconnectLinks","preconnectUrls","links","querySelectorAll","link","input","DEFAULT_PRELOADED_IMAGES_LIMIT","PRELOADED_IMAGES","PreloadLinkCreator","preloadedImages","errorShown","createPreloadLinkTag","renderer","srcset","sizes","size","preload","createElement","setAttribute","appendChild","head","BASE64_IMG_MAX_LENGTH_IN_ERROR","VALID_WIDTH_DESCRIPTOR_SRCSET","VALID_DENSITY_DESCRIPTOR_SRCSET","ABSOLUTE_SRCSET_DENSITY_CAP","RECOMMENDED_SRCSET_DENSITY_CAP","DENSITY_SRCSET_MULTIPLIERS","VIEWPORT_BREAKPOINT_CUTOFF","ASPECT_RATIO_TOLERANCE","OVERSIZED_IMAGE_TOLERANCE","FIXED_SRCSET_WIDTH_LIMIT","FIXED_SRCSET_HEIGHT_LIMIT","PLACEHOLDER_DIMENSION_LIMIT","DATA_URL_WARN_LIMIT","DATA_URL_ERROR_LIMIT","BUILT_IN_LOADERS","PRIORITY_COUNT_THRESHOLD","IMGS_WITH_PRIORITY_ATTR_COUNT","NgOptimizedImage","imageLoader","processConfig","IMAGE_CONFIG","Renderer2","imgElement","ElementRef","nativeElement","injector","Injector","lcpObserver","_renderedSrc","ngSrcset","height","decoding","loading","disableOptimizedSrcset","fill","placeholder","placeholderConfig","ngOnInit","performanceMarkFeature","ngZone","NgZone","assertNonEmptyInput","assertValidNgSrcset","assertNoConflictingSrc","assertNoConflictingSrcset","assertNotBase64Image","assertNotBlobUrl","assertEmptyWidthAndHeight","runOutsideAngular","assertNonZeroRenderedHeight","assertNonEmptyWidthAndHeight","assertGreaterThanZero","assertNoImageDistortion","assertValidLoadingInput","assertValidDecodingInput","assertNoComplexSizes","assertValidPlaceholder","assertNotMissingBuiltInLoader","assertNoNgSrcsetWithoutLoader","assertNoLoaderParamsWithoutLoader","getRewrittenSrc","checker","applicationRef","ApplicationRef","assetPriorityCountBelowThreshold","removePlaceholderOnLoad","setHostAttributes","setHostAttribute","getLoadingBehavior","getFetchPriority","getDecoding","rewrittenSrcset","updateSrcAndSrcset","preloadLinkCreator","ngOnChanges","changes","assertNoPostInitInputChange","isFirstChange","oldSrc","currentValue","assertPlaceholderDimensions","callImageLoader","configWithoutCustomParams","augmentedConfig","imgConfig","getRewrittenSrcset","widthSrcSet","finalSrcs","split","filter","map","srcStr","parseFloat","getAutomaticSrcset","getResponsiveSrcset","getFixedSrcset","breakpoints","filteredBreakpoints","bp","forceSrcRecalc","shouldGenerateAutomaticSrcset","multiplier","oversizedImage","generatePlaceholder","placeholderInput","placeholderResolution","shouldBlurPlaceholder","hasOwnProperty","Boolean","blur","callback","changeDetectorRef","ChangeDetectorRef","removeLoadListenerFn","removeErrorListenerFn","markForCheck","listen","callOnLoadIfImageIsLoaded","Directive","ɵdir","ɵɵngDeclareDirective","isStandalone","selector","inputs","unwrapSafeUrl","numberAttribute","booleanAttribute","booleanOrUrlAttribute","host","properties","usesOnChanges","args","Input","required","transform","sortedBreakpoints","sort","a","b","assign","IMAGE_CONFIG_DEFAULTS","dir","substring","match","assertNoPlaceholderConfigWithoutPlaceholder","assertNoRelativePlaceholderWithoutLoader","assertNoOversizedDataUrl","isEmptyString","stringVal","isValidWidthDescriptor","isValidDensityDescriptor","assertUnderDensityCap","isValidSrcset","underDensityCap","every","num","postInitInputChangeError","inputName","reason","forEach","isUpdated","previousValue","inputValue","validNumber","validString","parseInt","computedStyle","getComputedStyle","renderedWidth","getPropertyValue","renderedHeight","boxSizing","paddingTop","paddingRight","paddingBottom","paddingLeft","renderedAspectRatio","nonZeroRenderedDimensions","intrinsicWidth","naturalWidth","intrinsicHeight","naturalHeight","intrinsicAspectRatio","suppliedWidth","suppliedHeight","suppliedAspectRatio","inaccurateDimensions","Math","abs","stylingDistortion","round","recommendedWidth","recommendedHeight","oversizedWidth","oversizedHeight","missingAttributes","attr","clientHeight","validInputs","includes","builtInLoaderName","loader","appRef","whenStable","complete","Number","isInteger","toFixed","unwrapSafeValue"],"mappings":"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"}