<div class="bd-links w-100" id="bd-docs-nav">
  {{- $url := split .Permalink "/" -}}
  {{- $page_slug := index $url (sub (len $url) 2) -}}

  <ul class="bd-links-nav list-unstyled mb-none pb-medium pb-md-shorter pe-lg-shorter">
  {{- range $group := .Site.Data.sidebar -}}
    {{- $link := $group.title -}}
    {{- $link_slug := $link | urlize -}}

    {{- if $group.pages -}}
      {{- $link = index $group.pages 0 -}}
      {{- $link_slug = $link.title | urlize -}}
    {{- end -}}

    {{- $group_slug := $group.title | urlize -}}
    {{- $is_active_group := eq $.Page.Params.group $group_slug -}}

    <li class="bd-links-group py-shorter">
      <strong class="bd-links-heading d-flex w-100 align-items-center fw-semibold">
        {{- if $group.icon }}
          <svg class="bi me-shortest"{{- if $group.icon_color }} style="color: var(--bs-{{ $group.icon_color }});"{{- end }} aria-hidden="true"><use xlink:href="#{{ $group.icon }}"></use></svg>
        {{- end }}
        {{ $group.title }}
      </strong>

      <ul class="list-unstyled fw-normal mt-shortest pb-shorter small">
        {{- range $doc := $group.pages -}}
          {{- $doc_slug := $doc.title | urlize -}}
          {{- $is_draft := $doc.draft -}}
          {{- $is_active := and $is_active_group (eq $page_slug $doc_slug) -}}
          {{ if eq $group_slug "migrations" }}
            {{- $is_active = eq $page_slug $doc_slug -}}
          {{ end }}
          {{- $href := urls.JoinPath "/docs" $.Site.Params.docs_version $group_slug $doc_slug "/" }}
          {{ if eq $group_slug "migrations" }}
            {{- $href = urls.JoinPath "/docs" $.Site.Params.docs_version $doc_slug "/" }}
          {{ end }}
          <li><a href="{{ $href }}" class="bd-links-link d-inline-block{{ if $is_active }} active{{ end }}{{if $is_draft }} text-decoration-line-through{{ end }}"{{ if $is_active }} aria-current="page"{{ end }}>{{ $doc.title }}{{if $is_draft }}<span class="visually-hidden">page is not yet available</span>{{ end }}</a></li>
        {{- end }}
      </ul>
    </li>
  {{- end }}
  </ul>
</div>
